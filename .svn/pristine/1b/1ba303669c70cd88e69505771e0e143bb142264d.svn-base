webpackJsonp([10],{"39K/":function(t,a){},"6CCR":function(t,a){},"9YdF":function(t,a){},AY2K:function(t,a){},TeSc:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Dd8w"),n=e.n(i),s=e("CFN8"),o=e("d32x"),c={data:function(){return{saveBtnStatus:!1,objectAndDefine:{},tagList:[],dataBack:[]}},props:{selfTrait:{type:Boolean,default:!0},groupTrait:{type:Boolean,default:!0},URI:{type:Object,default:function(){}},itemInfo:{type:Object,default:function(){return{}}}},components:{editTitle:s.a,TraitInput:o.a},computed:{hasChanged:function(){var t=this.$lodash.cloneDeep(this.tagList.map(function(t){return t.code})).sort(),a=this.$lodash.cloneDeep(this.dataBack.map(function(t){return t.code})).sort();return this.$lodash.isEqual(t,a)}},watch:{itemInfo:{handler:function(){this.initData()},deep:!0}},mounted:function(){this.initData()},methods:{initData:function(){if(this.tagList=this.$lodash.cloneDeep(this.itemInfo.values||[]),this.tagList){var t=this.$lodash.cloneDeep(this.tagList.map(function(t){return t.name})),a=this.$lodash.cloneDeep(this.tagList.map(function(t){return t.code}));this.objectAndDefine={names:t,value:a},this.dataBack=this.$lodash.cloneDeep(this.tagList)}},ok:function(){this.$emit("confirm",this.itemInfo,this.tagList)},cancel:function(){this.$emit("cancel"),this.$emit("close-modal",!1)},setObject:function(t){t.names.length>100||(this.objectAndDefine=this.$lodash.cloneDeep(t),this.clearSetObject(t))},clearSetObject:function(){var t=this;this.tagList=this.objectAndDefine.names.map(function(a,e){return{name:a,code:t.objectAndDefine.value[e]}})}}},l={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mask-bg"},[e("edit-title",{attrs:{loading:t.saveBtnStatus,disabled:t.hasChanged,title:"授权特性"},on:{"cancel-click":t.cancel,"ok-click":t.ok}}),t._v(" "),e("div",{staticClass:"custom-dialog-content"},[e("div",{staticClass:"dialog-padding20"},[e("Card",{staticClass:"item-box",attrs:{"dis-hover":""}},[e("Row",{staticStyle:{"font-weight":"bold"}},[e("Col",[t._v(" 授权给"+t._s(t.itemInfo.titleType)+"："+t._s(t.itemInfo.title)+"\n                    ")])],1),t._v(" "),e("Divider",{staticStyle:{margin:"20px 0 0"}}),t._v(" "),e("Row",{staticClass:"mt20"},[e("Col",[e("Form",{attrs:{"label-position":"left","label-width":80}},[e("Form-item",{staticClass:"nopl",staticStyle:{"margin-bottom":"0"},attrs:{label:"授权特性"}},[e("TraitInput",{attrs:{count:100,closable:!0,btnType:!0,isShowTagList:!0,URI:t.URI,selfTrait:t.selfTrait,groupTrait:t.groupTrait,multiple:!0,value:t.objectAndDefine},on:{"on-change":t.setObject}})],1)],1)],1)],1)],1)],1)])],1)},staticRenderFns:[]};var r=e("VU/8")(c,l,!1,function(t){e("xhIl")},null,null).exports,u=e("vhtY"),d={data:function(){return{saveBtnStatus:!1,tagList:[],dataList:[],dataBack:[]}},props:{itemInfo:{type:Object,default:function(){return{}}}},components:{editTitle:s.a,buttonSelect:u.a},computed:{hasChanged:function(){var t=this.$lodash.cloneDeep(this.tagList.map(function(t){return t.value})).sort(),a=this.$lodash.cloneDeep(this.dataBack.map(function(t){return t.value})).sort();return this.$lodash.isEqual(t,a)}},mounted:function(){this.init()},methods:{init:function(){var t=this;this.getEventList().then(function(a){var e=a.data;t.dataList=e.items.map(function(t){return{label:t.name,value:t.code}}),t.getTagList()})},getEventList:function(){return this.$axios.get(this.$config.apiDomain+"/events",{params:{authorized:!1,size:-1}})},getTagList:function(){var t=this,a="/res-auth/source-channel/cur-channel/target-channel/"+this.itemInfo.target_channel_code+"/events-auth";this.$axios.get(""+this.$config.apiDomain+a,{params:{}}).then(function(a){var e=a.data;e.auth_info&&(t.tagList=e.auth_info.map(function(t){return{label:t.source_name,value:t.source_code}}),t.dataBack=t.$lodash.cloneDeep(t.tagList))})},saveEvent:function(){var t=this,a="/res-auth/source-channel/cur-channel/target-channel/"+this.itemInfo.target_channel_code+"/events-auth",e=this.tagList.map(function(t){return t.value});this.$axios({method:"put",url:""+this.$config.apiDomain+a,data:e}).then(function(){t.saveBtnStatus=!1,t.cancel(),t.$Message.destroy(),t.$Message.success("已修改"),t.$parent.$parent.getData()}).catch(function(){t.saveBtnStatus=!1})},cancel:function(){this.$parent.$parent.showDetail=!1},onChange:function(t){this.tagList=t}}},h={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mask-bg"},[e("edit-title",{attrs:{loading:t.saveBtnStatus,disabled:t.hasChanged,title:"授权事件"},on:{"cancel-click":t.cancel,"ok-click":t.saveEvent}}),t._v(" "),e("div",{staticClass:"custom-dialog-content"},[e("div",{staticClass:"dialog-padding20"},[e("Card",{staticClass:"item-box",attrs:{"dis-hover":""}},[e("Row",{staticStyle:{"font-weight":"bold"}},[e("Col",[t._v(" 授权给渠道："+t._s(t.itemInfo.target_channel_name)+"\n                    ")])],1),t._v(" "),e("Divider",{staticStyle:{margin:"20px 0 0"}}),t._v(" "),e("Row",{staticClass:"mt20"},[e("Col",[e("Form",{attrs:{"label-position":"left","label-width":70}},[e("Form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"授权事件:"}},[e("button-select",{attrs:{count:"100","btn-text":"事件","tag-list":t.tagList,"data-list":t.dataList},on:{"on-select-change":t.onChange}})],1)],1)],1)],1)],1)],1)])],1)},staticRenderFns:[]};var f={data:function(){var t=this;return{showDetail:!1,loadingOrNoData:"数据加载中...",isLoading:!0,itemInfo:{},detailName:"",URI:{traitsParams:{authorized:!1,data_type:this.$config.data_type_list},catalogsParams:{authorized:!1,data_type:this.$config.data_type_list},searchParams:{authorized:!1,data_type:this.$config.data_type_list}},gridList:{columns:[{title:"渠道名称",key:"target_channel_name",ellipsis:!0,tooltip:!0},{title:"渠道类型",key:"target_channel_type",ellipsis:!0,tooltip:!0},{title:"渠道ID",key:"target_channel_code",ellipsis:!0,tooltip:!0},{title:"授权特性",key:"action",width:150,render:function(a,e){var i=!e.row.idmapping;return a("div",[a("a",{style:i&&{color:"#999",cursor:"not-allowed"},on:{click:function(){i||t.actionDetailName(e,"Trait")}}},e.row.trait_auth+"个")])}}],data:[]}}},components:{Trait:r,Event:e("VU/8")(d,h,!1,function(t){e("6CCR")},null,null).exports},mounted:function(){this.getData()},methods:{actionDetailName:function(t,a){var e=this,i=t.row;if("Trait"==a){var s="/res-auth/source-channel/cur-channel/target-channel/"+i.target_channel_code+"/traits-auth";this.$axios.get(""+this.$config.apiDomain+s,{params:{}}).then(function(a){var s=a.data;e.itemInfo=n()({title:t.row.target_channel_name,titleType:"渠道",values:s.auth_info&&s.auth_info.map(function(t){return{name:t.source_name,code:t.source_code}})},i)})}else if("Event"==a)this.itemInfo=n()({title:"渠道"},i);else if("Touch"==a)return;this.detailName=a,this.showDetail=!0},getData:function(){var t=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0;this.$axios.get(this.$config.apiDomain+"/res-auth/statistics",{params:{size:-1}}).then(function(a){var e=a.data;e.items.length||(t.loadingOrNoData="暂无数据"),t.gridList.data=e.items,t.total=e.total,t.isLoading=!1}).catch(function(){t.total=0,t.gridList.data=[],t.loadingOrNoData="数据加载失败",t.isLoading=!1})},confirm:function(t,a){var e=this,i="/res-auth/source-channel/cur-channel/target-channel/"+t.target_channel_code+"/traits-auth",n=a.map(function(t){return t.code});this.$axios.put(""+this.$config.apiDomain+i,n).then(function(){e.showDetail=!1,e.$Message.destroy(),e.$Message.success("已修改"),e.getData()}).catch(function(t){"ERROR_CROSS_CHANNEL_TRAIT_ACTIVE_THRESHOLD"==t.response.data.sub_code&&(e.$Message.destroy(),e.$Message.error({content:t.response.data.message,duration:7})),e.showDetail=!0})},closeModal:function(){this.showDetail=!1}}},m={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("Card",{attrs:{"dis-hover":"",padding:0}},[e("Row",{staticClass:"padding16-18"},[e("div",{staticClass:"title"},[t._v("对以下渠道授权访问")])]),t._v(" "),e("Row",[e("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.isLoading,"no-data-text":t.loadingOrNoData,columns:t.gridList.columns,data:t.gridList.data}})],1)],1),t._v(" "),e("Drawer",{attrs:{width:"1000","mask-closable":!1},model:{value:t.showDetail,callback:function(a){t.showDetail=a},expression:"showDetail"}},[t.showDetail?e(t.detailName,{tag:"component",attrs:{"self-trait":!1,"group-trait":!1,URI:t.URI,itemInfo:t.itemInfo},on:{confirm:t.confirm,"close-modal":t.closeModal}}):t._e()],1)],1)},staticRenderFns:[]};var g={name:"outerSystem",components:{SetTrait:r},mounted:function(){this.getData()},data:function(){return{isLoading:!0,loadingOrNoData:"数据加载中...",isShow:!1,name:"",URI:{traits:this.$config.apiDomain+"/traits",traitsParams:{authorized:!1,lifecycle_status:"active",data_type:this.$config.data_type_list},catalogsParams:{authorized:!1,data_type:this.$config.data_type_list},searchParams:{lifecycle_status:"active",authorized:!1,data_type:this.$config.data_type_list}},itemInfo:{},columns:[{title:"账号名称",key:"sys_name"},{title:"授权特性",slot:"action",width:400}],data:[]}},methods:{getData:function(){var t=this;this.isLoading=!0,this.loadingOrNoData="数据加载中...";var a=this.$config.apiDomain+"/open-platform/auth/list";this.$axios.get(a,{params:{size:-1}}).then(function(a){var e=a.data;t.isLoading=!1,t.data=e.items,t.data.length||(t.loadingOrNoData="暂无数据")}).catch(function(){t.data=[],t.loadingOrNoData="数据加载失败",t.isLoading=!1})},show:function(t){this.itemInfo=n()({titleType:"账号",title:t.sys_name,values:t.auth_values},t),this.isShow=!0},confirm:function(t,a){var e=this,i=this.$config.apiDomain+"/open-platform/auth/modify/"+t.sys_id,n={auth_values:a};this.$axios.put(i,n).then(function(){e.isShow=!1,e.$Message.destroy(),e.$Message.success("已修改"),e.getData()}).catch(function(){e.isShow=!0})},closeModal:function(){this.isShow=!1}}},p={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"auth-outer-system"},[e("Card",{attrs:{"dis-hover":"",padding:0}},[e("h3",{staticClass:"title padding16-18"},[t._v("\n            对以下外部系统授权访问\n        ")]),t._v(" "),e("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.isLoading,"no-data-text":t.loadingOrNoData,columns:t.columns,data:t.data},scopedSlots:t._u([{key:"action",fn:function(a){var i=a.row,n=a.index;return[e("span",{staticClass:"action-button",on:{click:function(a){t.show(i,n)}}},[t._v(t._s(i.auth_values&&i.auth_values.length)+" 个")])]}}])})],1),t._v(" "),e("Drawer",{attrs:{width:"1000","mask-closable":!1},model:{value:t.isShow,callback:function(a){t.isShow=a},expression:"isShow"}},[t.isShow?e("set-trait",{attrs:{"self-trait":!1,"group-trait":!1,URI:t.URI,"item-info":t.itemInfo},on:{confirm:t.confirm,"close-modal":t.closeModal}}):t._e()],1)],1)},staticRenderFns:[]};var v={name:"SystemAuthori",components:{innerChannel:e("VU/8")(f,m,!1,function(t){e("39K/")},"data-v-28a0f364",null).exports,outerSystem:e("VU/8")(g,p,!1,function(t){e("9YdF")},"data-v-304b9066",null).exports},data:function(){return{active_name:null}},computed:{activeName:function(){if(this.active_name)return this.active_name;for(var t=this.$config.login_info.role_view.buttons,a=!1,e=0;e<t.length;e++)if("cross_channel_access_auth"===t[e].id)return a=!0,t[e].visible?"innerChannel":"outerSystem";return a?void 0:"outerSystem"}},created:function(){this.debounceSelect=this.$lodash.debounce(this.tabChange,this.$config.debounce_wait)},methods:{tabChange:function(t){this.activeName=t}},watch:{},destroyed:function(){}},_={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"page-warpper"},[e("div",{staticClass:"page-title bottom-shadow page-title-tab"},[e("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":t.activeName},on:{"on-select":t.debounceSelect}},[e("MenuItem",{directives:[{name:"role-button",rawName:"v-role-button",value:"cross_channel_access_auth",expression:"`cross_channel_access_auth`"}],attrs:{name:"innerChannel"}},[t._v("跨渠道访问授权")]),t._v(" "),e("MenuItem",{attrs:{name:"outerSystem"}},[t._v("外部系统访问授权")])],1)],1),t._v(" "),e("div",{staticClass:"channel-manage page-content page-content-tab container-padding24"},[e(t.activeName,{tag:"component",attrs:{name:t.activeName}})],1)])},staticRenderFns:[]};var b=e("VU/8")(v,_,!1,function(t){e("xFjs")},"data-v-c7ed0778",null);a.default=b.exports},vhtY:function(t,a,e){"use strict";var i={name:"ButtonSelect",data:function(){return{tagValueList:[],tagIdList:""}},props:{multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isShowTag:{type:Boolean,default:!0},btnText:{type:String,default:"请选择"},count:{type:[Number,String],default:1/0},tagList:{type:[Array,Object],default:function(){return[]}},dataList:{type:Array,default:function(){return[]}}},mounted:function(){var t=this;document.querySelectorAll(".button-select-box .ivu-select-selection>div").forEach(function(a){a.innerHTML="<button"+(t.disabled?" disabled":"")+' type="button" class="ivu-btn ivu-btn-default"> <i class="ivu-icon ivu-icon-md-add"></i> <span>'+t.btnText+"</span></button>"})},methods:{onSelectChange:function(t){this.multiple?(t.length>this.count&&(t.pop(),this.tagValueList=t,this.$Message.destroy(),this.$Message.error("最多添加"+this.count+"个")),this.tagValueList=t,this.$emit("on-select-change",t)):t&&(this.tagValueList=[t])},setValue:function(){this.multiple?this.tagIdList=this.tagValueList.map(function(t){return t.value}):this.tagValueList[0]&&(this.tagIdList=this.tagValueList[0].value)},closeTag:function(t){this.tagValueList.splice(t,1),this.multiple||(this.tagIdList="")}},watch:{tagList:{handler:function(){this.tagValueList=this.tagList},immediate:!0},tagValueList:{handler:function(){this.setValue()},immediate:!0}}},n={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"button-select-box"},[e("div",{staticClass:"button-select"},[e("Select",{attrs:{"label-in-value":"",multiple:t.multiple},on:{"on-change":t.onSelectChange},model:{value:t.tagIdList,callback:function(a){t.tagIdList=a},expression:"tagIdList"}},t._l(t.dataList,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}))],1),t._v(" "),t.isShowTag&&t.tagValueList.length?e("div",{staticClass:"mt16"},t._l(t.tagValueList,function(a,i){return e("Tag",{key:i,staticClass:"mtb5 select-tag-list",attrs:{name:a.value,closable:""},on:{"on-close":function(a){t.closeTag(i)}}},[t._v(t._s(a.label))])})):t._e()])},staticRenderFns:[]};var s=e("VU/8")(i,n,!1,function(t){e("AY2K")},null,null);a.a=s.exports},xFjs:function(t,a){},xhIl:function(t,a){}});