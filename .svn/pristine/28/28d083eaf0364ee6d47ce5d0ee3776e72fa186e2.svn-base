webpackJsonp([11],{"1jHF":function(e,t){},"4/xz":function(e,t){},JD5G:function(e,t,a){"use strict";var i=a("//Fk"),s=a.n(i),n=a("CFN8"),r={data:function(){return{saveBtnStatus:!1,groupId:"",selectLeaderData:[],leaderData:"",changedLeader:"",selectMemberData:[],memberData:[],changedMember:[],formValidate:{name:"",groupMember:[]},ruleValidate:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{pattern:this.$config.reg_input.reg,message:this.$config.reg_input.msg,trigger:"blur"}],groupLeader:[{required:!0,message:"请选择一个责任人",trigger:"change"}]},dataBack:{}}},props:{titleName:{type:String,default:"添加运营组"},groupInfo:{type:Object,default:function(){return{}}},orgInfo:{type:Object,default:function(){return{}}},isOperSpe:{type:Boolean,default:!1}},components:{editTitle:n.a},computed:{hasChanged:function(){return this.$lodash.isEqual(this.formValidate,this.dataBack)}},methods:{getGroupLeader:function(e){-1!==this.changedMember.indexOf(e)?(this.$Message.destroy(),this.$Message.error({content:"该成员已被设为组员",duration:3})):(this.formValidate.groupLeader=e,this.changedLeader=e)},getGroupMember:function(e){this.formValidate.groupMember=e,this.changedMember=e,this.getMemberVal()},cancelEdit:function(){this.$emit("show-drawer",!1)},okEdit:function(){this.handleSubmit("formValidate")},getLeaderData:function(){var e="/sys/groups/channel-leaders";return this.orgInfo.org_id&&(e="/sys/groups/"+this.orgInfo.org_id+"/org-leaders"),this.isOperSpe?new s.a(function(e){e()}):this.$axios.get(""+this.$config.apiDomain+e,{params:{size:-1}})},getMemberData:function(){var e="/sys/orgs/"+this.$config.login_info.auth_info.org_id+"/org-members";return this.$axios.get(""+this.$config.apiDomain+e,{params:{size:-1}})},getCondition:function(){var e=this,t=this.$config.login_info.user_info.user_id;this.$axios.all([this.getMemberData()]).then(this.$axios.spread(function(a){if(a&&a.data.items.forEach(function(t){e.selectMemberData.push({name:t.name,label:t.username,value:t.user_id})}),e.groupInfo.name)e.groupId=e.groupInfo.groupId,e.formValidate.name=e.groupInfo.name,e.formValidate.groupLeader=e.groupInfo.leaderId,e.formValidate.groupMember=e.groupInfo.groupMembersArr,e.getMemberVal();else if(e.isOperSpe){var i=e.$config.login_info.user_info.user_id;e.formValidate.groupLeader=i}e.groupInfo.name||(e.formValidate.groupMember=[t]),e.changedMember=e.formValidate.groupMember,e.dataBack=e.$lodash.cloneDeep(e.formValidate)}))},getMemberVal:function(){var e=this,t=this.selectMemberData.filter(function(t){return-1!==e.formValidate.groupMember.indexOf(t.value)});this.memberData=t},editGroup:function(){var e=this,t=this.formValidate,a="",i="";this.groupInfo.name?(a="put",i="已修改"):(a="post",i="已添加");var s=this.memberData.map(function(e){return{user_id:e.value}}),n={group_id:this.groupId||void 0,name:t.name,group_members:s};this.$axios({method:a,url:this.$config.apiDomain+"/sys/groups",data:n}).then(function(){e.updateList(i)}).catch(function(){e.saveBtnStatus=!1})},updateList:function(e){this.saveBtnStatus=!1,this.cancelEdit(),this.$Message.destroy(),this.$Message.success(e),this.$tools.bus.$emit("updateGroupList")},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(e){e?(t.saveBtnStatus=!0,t.editGroup()):t.saveBtnStatus=!1})}},mounted:function(){this.getCondition()}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"slide-create-box"},[a("edit-title",{attrs:{loading:e.saveBtnStatus,disabled:e.hasChanged,title:e.titleName},on:{"cancel-click":e.cancelEdit,"ok-click":e.okEdit}}),e._v(" "),a("div",{staticClass:"slide-scroll-box"},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate}},[a("div",{staticClass:"dialog-padding20"},[a("Card",{attrs:{"dis-hover":""}},[a("div",{staticClass:"form-title"},[e._v("运营组名称")]),e._v(" "),a("Form-item",{staticClass:"mb10",attrs:{prop:"name"}},[a("Input",{staticClass:"width400",attrs:{maxlength:20,placeholder:"请输入运营组名称"},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name","string"==typeof t?t.trim():t)},expression:"formValidate.name"}})],1)],1),e._v(" "),a("Card",{staticClass:"mt20",attrs:{"dis-hover":""}},[a("div",{staticClass:"form-title"},[e._v("运营组成员")]),e._v(" "),a("Form-item",{staticClass:"mb10"},[a("Select",{staticClass:"width400",attrs:{placeholder:"请选择组员",multiple:"",filterable:""},on:{"on-change":e.getGroupMember},model:{value:e.formValidate.groupMember,callback:function(t){e.$set(e.formValidate,"groupMember",t)},expression:"formValidate.groupMember"}},e._l(e.selectMemberData,function(t){return a("Option",{key:t.value,attrs:{value:t.value,label:t.name}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{staticClass:"name-email"},[e._v(e._s(t.label))])])}))],1)],1)],1)])],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,o,!1,function(e){a("vXY3")},"data-v-24550fb0",null).exports,l=a("txAQ"),u={data:function(){var e=this;this.$createElement;return{showEidt:!1,titleName:"",groupInfo:{},currentPage:1,pageSize:10,total:0,loadingOrNoData:"数据加载中...",isLoading:!1,searInput:"",selectTransferData:[],gridList:{columns:[{title:"运营组名称",key:"name",ellipsis:!0,tooltip:!0},{title:"组成员",key:"groupMembersStr",ellipsis:!0,tooltip:!0},{title:"修改人",key:"updateName",ellipsis:!0,tooltip:!0},{title:"修改时间",key:"updateTime",width:180},{title:"操作",key:"action",width:180,render:function(t,a){return t("div",[t("div",[t("a",{on:{click:function(){return e.creatGroup(a.row)}}},["修改"]),t("a",{style:"margin: 0 10px",on:{click:function(){return e.confirmDelete(a.row)}}},["删除"]),t(l.a,{attrs:{type:"group",orginInfo:a.row,selectData:e.selectTransferData}})])])}}],data:[]}}},props:{orgInfo:{type:Object,default:function(){return{}}},isOperSpe:{type:Boolean,default:!1}},created:function(){this.debounceSearch=this.$lodash.debounce(this.searIconClick,this.$config.debounce_wait),this.getTransferData()},mounted:function(){var e=this;this.$tools.bus.$on("updateGroupList",function(){e.searInput="",e.currentPage=1,e.getData()})},beforeDestroy:function(){this.$tools.bus.$off("updateGroupList")},components:{addGroup:c},methods:{showDrawer:function(e){this.showEidt=e},searIconClick:function(){this.currentPage=1,this.getData()},creatGroup:function(e){this.titleName=e.groupId?"修改运营组":"新建运营组",this.groupInfo=e,this.showEidt=!0},getTransferData:function(){var e=this;this.$axios.get(this.$config.apiDomain+"/sys/groups?size=-1").then(function(t){var a=t.data;e.selectTransferData=a.items.map(function(e){return{name:e.name,value:e.group_id}}),e.getData()}).catch(function(){e.selectTransferData=[]})},confirmDelete:function(e){var t=this;this.$Modal.confirm({title:"确认删除此运营组？",content:"名称："+e.name+"<br><br>删除后将无法恢复。",onOk:function(){t.deleteGroup(e.groupId)}})},deleteGroup:function(e){var t=this,a="/sys/groups/"+e;this.$axios.delete(""+this.$config.apiDomain+a,{}).then(function(){t.$Message.success("已删除"),t.currentPage>1&&1==t.gridList.data.length&&t.currentPage--,t.getData()})},getData:function(){var e=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0;var t={q:this.searInput,page:this.currentPage,rows:this.pageSize};this.$axios.get(this.$config.apiDomain+"/sys/groups",{params:t}).then(function(t){var a=t.data;e.isLoading=!1,a.items.length||(e.loadingOrNoData="暂无数据"),e.gridList.data=e.clearData(a.items),e.total=a.total}).catch(function(){e.total=0,e.gridList.data=[],e.loadingOrNoData="数据加载失败",e.isLoading=!1})},clearData:function(e){var t=this,a=[];return e.forEach(function(e){var i=[],s=[];for(var n in e.group_members)s.push(e.group_members[n].user_id),i.push(e.group_members[n].name);a.push({updateTime:e.create_time?t.$date(+e.update_time).format("YYYY-MM-DD HH:mm:ss"):"-",id:e.group_id,groupId:e.group_id,groupMembers:e.group_members,groupMembersArr:s,groupMembersStr:i.join("，"),leaderId:e.leader_id,updateName:e.updater_name,name:e.name})}),a},pageChange:function(e){this.currentPage=e,this.getData()}},watch:{orgInfo:function(){this.searInput="",this.currentPage=1,this.getData()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{staticClass:"m24",attrs:{"dis-hover":"",padding:0}},[a("Row",{staticClass:"padding16-18"},[a("Col",{attrs:{span:"16"}},[a("Input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"请输入运营组名称"},on:{"on-change":e.debounceSearch},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.debounceSearch(t):null}},model:{value:e.searInput,callback:function(t){e.searInput=t},expression:"searInput"}}),e._v(" "),a("span",{staticClass:"total-count"},[e._v("共"),a("i",[e._v(e._s(e.total))]),e._v("个运营组")])],1),e._v(" "),a("Col",{staticStyle:{"text-align":"right"},attrs:{span:"8"}},[a("Button",{attrs:{icon:"md-add",type:"primary"},on:{click:function(t){e.creatGroup({})}}},[e._v("新建运营组")])],1)],1),e._v(" "),a("Row",[a("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:e.isLoading,"no-data-text":e.loadingOrNoData,columns:e.gridList.columns,data:e.gridList.data}}),e._v(" "),a("Row",{staticClass:"pageRow padding16-18",attrs:{type:"flex",justify:"end"}},[a("Page",{attrs:{total:e.total,current:e.currentPage,"show-elevator":""},on:{"on-change":e.pageChange}})],1)],1),e._v(" "),a("Drawer",{attrs:{width:"600","mask-closable":!1},model:{value:e.showEidt,callback:function(t){e.showEidt=t},expression:"showEidt"}},[e.showEidt?a("addGroup",{attrs:{orgInfo:e.orgInfo,isOperSpe:e.isOperSpe,titleName:e.titleName,groupInfo:e.groupInfo},on:{"show-drawer":e.showDrawer}}):e._e()],1)],1)},staticRenderFns:[]};var g=a("VU/8")(u,d,!1,function(e){a("4/xz")},"data-v-7e3e988d",null);t.a=g.exports},gcTD:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("JD5G"),s=a("oSpf"),n={name:"Group",components:{OperationGroup:i.a,Specialist:s.a},data:function(){return{activeName:"OperationGroup",tabList:[{label:"运营组管理",name:"OperationGroup"},{label:"成员管理",name:"Specialist"}]}},created:function(){var e=this.$config.debounce_wait;this.debounceChange=this.$lodash.debounce(this.handleChange,e)},methods:{handleChange:function(e){this.activeName=e}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-warpper"},[a("div",{staticClass:"page-title bottom-shadow page-title-tab"},[a("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":e.activeName},on:{"on-select":e.debounceChange}},e._l(e.tabList,function(t,i){return a("MenuItem",{key:i,attrs:{name:t.name}},[e._v("\n                "+e._s(t.label)+"\n            ")])}))],1),e._v(" "),a("div",{staticClass:"page-content page-content-tab"},[a(e.activeName,{tag:"component",attrs:{isOrg:"",name:e.activeName}})],1)])},staticRenderFns:[]};var o=a("VU/8")(n,r,!1,function(e){a("t1ba")},"data-v-7a1b79b8",null).exports,c={name:"Member",components:{ChannelMember:o,Specialist:s.a},data:function(){return{userId:this.$config.login_info.auth_info.role_id,roleMap:{ROLE_D_ADMIN:o,ROLE_C_ADMIN:s.a}}}},l={render:function(){var e=this.$createElement;return(this._self._c||e)(this.roleMap[this.userId],{tag:"component"})},staticRenderFns:[]};var u=a("VU/8")(c,l,!1,function(e){a("vvdf")},"data-v-75db6194",null);t.default=u.exports},oSpf:function(e,t,a){"use strict";var i=a("txAQ"),s={data:function(){var e=this;this.$createElement;return{isMember:"/member"==this.$route.path,searInput:"",currentPage:1,pageSize:10,total:0,visible:!1,searMember:"",selectTransferData:[],loadingOrNoData:"数据加载中...",isLoading:!1,roleTypes:[{value:1,label:"节点管理员"},{value:0,label:"节点运营人员"}],roleList:{ROLE_C_ADMIN:"渠道管理员",ROLE_D_ADMIN:"节点管理员",ROLE_D_OPERATOR:"节点运营人员"},selectData:[],searLoading:!1,gridList:{columns:[{title:"姓名",key:"name"},{title:"邮箱",key:"email"},{renderHeader:function(t){return t("div",{style:{position:"relative",linehHeight:"40px"}},[t("span",{style:{paddingRight:"3px"}},"成员角色"),t("Tooltip",{style:{display:e.isMember?"none":""},props:{"max-width":"300",content:"被设为节点管理员的账号将具有管理本节点运营组，负责本节点资源初审的权限",placement:"top",transfer:!0}},[t("i",{style:{"font-size":"14px"},attrs:{class:"fa fa-question-circle-o"}})])])},key:"is_admin",render:function(t,a){return t("div",[t("icon",{attrs:{size:"20",color:a.row.is_admin?"#06B75E":"#AFB2BA",type:"md-contact"}}),e.isMember?t("span",{style:"padding-left:5px;"},[e.roleList[a.row.role_id]||"-"]):t("i-select",{attrs:{transfer:!0,size:"small",value:a.row.is_admin},on:{"on-change":function(t){e.changeIsLeader(a,t)}},class:"role-select",style:"width:105px;"},[e.roleTypes.map(function(e){return t("i-option",{attrs:{value:e.value}},[e.label])})])])}},{title:"操作",key:"action",width:150,render:function(t,a){return t("div",[e.isMember?t(i.a,{attrs:{type:"self",orginInfo:a.row,selectData:e.selectTransferData}}):t("a",{style:"margin: 0 10px 0 0",on:{click:function(){return e.confirmDelete(a.row)}}},["删除"])])}}],data:[]}}},props:{orgInfo:{type:Object,default:function(){return{}}},isOrg:Boolean},created:function(){var e=this.$config.throttle_wait;this.debounceSearch=this.$lodash.debounce(this.remoteMethod,e),this.debouncePage=this.$lodash.debounce(this.pageChange,e),this.debounceSearchList=this.$lodash.debounce(this.searIconClick,this.$config.debounce_wait),this.getTransferData()},methods:{handleOpen:function(){this.visible=!this.visible},handleClose:function(e){this.isClickSelf(e.target)||(this.visible=!1,this.resetAddInput())},getTransferData:function(){var e=this;this.$axios.get(this.$config.apiDomain+"/sys/resource/users?size=-1").then(function(t){var a=t.data;e.selectTransferData=a.items.map(function(e){return{name:e.name,label:e.email,value:e.user_id}}),e.isMember&&e.getData()}).catch(function(){e.selectTransferData=[]})},searIconClick:function(){this.currentPage=1,this.getData()},changeIsLeader:function(e,t){var a=this;e.row.is_admin=t;var i="/sys/orgs/auth/"+e.row.user_id+"?is_admin="+!!t;this.$axios.put(""+this.$config.apiDomain+i).then(function(){a.$Message.success("已修改")}).catch(function(){e.row.is_admin=1==t?0:1})},addSpecia:function(e){var t=this;if(e){var a=e.value,i="/sys/operators/channel-operators/"+a;this.orgInfo.org_id&&(i="/sys/orgs/"+this.orgInfo.org_id+"/auth"),this.$axios.post(""+this.$config.apiDomain+i,{user_id:a,role_id:"ROLE_D_OPERATOR"}).then(function(){t.$Message.success("已添加"),t.currentPage=1,t.getData(),t.resetAddInput(),t.visible=!1}).catch(function(){t.resetAddInput(),t.visible=!1})}},resetAddInput:function(){this.searInput="",this.searMember="",this.selectData=[]},confirmDelete:function(e){var t=this;this.$Modal.confirm({title:"确认取消授权此帐号？",content:"姓名："+e.name+"<br/><br/>取消授权后，此账号将无法登陆当前渠道。",onOk:function(){t.deleteAccount(e.user_id)}})},deleteAccount:function(e){var t=this,a="/sys/orgs/auth/"+e;this.$axios.delete(""+this.$config.apiDomain+a,{}).then(function(){t.$Message.success("取消授权成功"),t.currentPage>1&&1==t.gridList.data.length&&t.currentPage--,t.getData()})},getData:function(){var e=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0;var t="/sys/orgs/"+this.orgInfo.org_id+"/org-members";this.isMember&&(t="/sys/resource/users");var a={q:this.searInput||void 0,page:this.currentPage,rows:this.pageSize};this.$axios.get(""+this.$config.apiDomain+t,{params:a}).then(function(t){var a=t.data;a.items.length||(e.loadingOrNoData="暂无数据"),e.gridList.data=a.items.map(function(e){return{name:e.name,email:e.email,id:e.user_id,user_id:e.user_id,role_id:e.role_id,is_admin:+("ROLE_D_ADMIN"===e.role_id||"ROLE_C_ADMIN"===e.role_id||"ROLE_D_ADMIN"===e.role_id)}}),e.total=a.total,e.isLoading=!1}).catch(function(){e.total=0,e.gridList.data=[],e.loadingOrNoData="数据加载失败",e.isLoading=!1})},remoteMethod:function(){var e=this;if(""!==this.searMember){this.searLoading=!0;var t={q:this.searMember,size:-1};this.$axios.get(this.$config.apiDomain+"/sys/orgs/users",{params:t}).then(function(t){var a=t.data;e.searLoading=!1;var i=a.items.map(function(e){return{name:e.name,label:e.email,value:e.user_id}});e.selectData=i})}else this.selectData=[]},pageChange:function(e){this.currentPage=e,this.getData()},isClickSelf:function(e){var t=e,a=!1,i=1e3;if(null!=t){do{if(/add\-member\-box/.test(t.className)){a=!0;break}i--,t=t.parentNode}while(t&&t.nodeName&&"HTML"!=t.nodeName.toUpperCase()&&i>0);return a}}},watch:{orgInfo:function(){this.resetAddInput(),this.currentPage=1,this.getData()}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{m24:e.isOrg,"page-warpper":!e.isOrg}},[e.isOrg?e._e():a("div",{staticClass:"page-title bottom-shadow page-title-tab"},[a("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":"insight"}},[a("MenuItem",{attrs:{name:"insight"}},[e._v("成员管理")])],1)],1),e._v(" "),a("div",{staticClass:"page-content page-content-tab",class:{"container-padding24":!e.isOrg}},[a("Card",{attrs:{"dis-hover":"",padding:0}},[a("Row",{staticClass:"padding16-18"},[a("Col",{staticClass:"search-wrapper"},[e.isMember?a("Input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"请输入姓名/邮箱"},on:{"on-change":e.debounceSearchList},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.debounceSearchList(t):null}},model:{value:e.searInput,callback:function(t){e.searInput=t},expression:"searInput"}}):a("Dropdown",{attrs:{trigger:"custom",placement:"bottom-start",transfer:"",visible:e.visible,"transfer-class-name":"add-member-box"},on:{click:e.handleOpen,"on-clickoutside":e.handleClose}},[a("Button",{attrs:{icon:"md-add",type:"primary"},on:{click:e.handleOpen}},[e._v("添加成员")]),e._v(" "),a("DropdownMenu",{staticStyle:{padding:"10px 0 0"},attrs:{slot:"list"},slot:"list"},[a("div",{staticStyle:{padding:"0 16px"}},[a("Input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"请输入姓名/邮箱"},on:{"on-change":e.debounceSearch},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.debounceSearch(t):null}},model:{value:e.searMember,callback:function(t){e.searMember=t},expression:"searMember"}})],1),e._v(" "),a("div",{staticClass:"ivu-select-dropdown",staticStyle:{position:"static","box-shadow":"none","max-height":"135px",overflow:"auto"}},[a("ul",{directives:[{name:"show",rawName:"v-show",value:!e.selectData.length&&!e.searLoading&&e.searMember,expression:"!selectData.length&&!searLoading&&searMember"}],staticClass:"ivu-select-not-found"},[a("li",[e._v("无匹配数据")])]),e._v(" "),a("ul",{staticClass:"ivu-select-dropdown-list"},e._l(e.selectData,function(t){return a("li",{key:t.value,staticClass:"ivu-select-item",on:{click:function(a){e.addSpecia(t)}}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{staticClass:"name-email"},[e._v(e._s(t.label))])])})),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.searLoading,expression:"searLoading"}],staticClass:"ivu-select-loading"},[e._v("加载中")])])])],1),e._v(" "),a("span",{staticClass:"total-count"},[e._v("共"),a("i",[e._v(e._s(e.total))]),e._v("个成员")])],1)],1),e._v(" "),a("Row",[a("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:e.isLoading,"no-data-text":e.loadingOrNoData,columns:e.gridList.columns,data:e.gridList.data}}),e._v(" "),a("Row",{staticClass:"pageRow padding16-18",attrs:{type:"flex",justify:"end"}},[a("Page",{attrs:{total:e.total,current:e.currentPage,"show-elevator":""},on:{"on-change":e.debouncePage}})],1)],1)],1)],1)])},staticRenderFns:[]};var r=a("VU/8")(s,n,!1,function(e){a("1jHF")},null,null);t.a=r.exports},t1ba:function(e,t){},vXY3:function(e,t){},vvdf:function(e,t){}});