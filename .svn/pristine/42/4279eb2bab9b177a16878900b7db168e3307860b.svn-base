webpackJsonp([8],{"/BE9":function(t,a){},"2wEE":function(t,a){},BIyz:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("woOf"),i=e.n(n),s={name:"pagination",props:{total:{type:Number},current:{type:Number,default:1}},methods:{handleClick:function(t){this.$emit("get-data",t)}}},o={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"pagination"},[a("Page",{attrs:{total:this.total,current:this.current,"show-elevator":""},on:{"on-change":this.handleClick}})],1)},staticRenderFns:[]};var r=e("VU/8")(s,o,!1,function(t){e("GM/D")},null,null).exports,c=e("M4fF"),l=e("CFN8"),d={name:"AuthorizeManager",components:{editTitle:l.a},props:["channelId","isShowAuthManager"],data:function(){var t=this;return{isLoading:!1,isTableLoading:!1,checkedData:"",options:[],total:0,columns:[{title:"姓名",key:"name"},{title:"邮箱",key:"email"},{title:"操作",width:100,align:"center",render:function(a,e){return a("a",{on:{click:function(){t.remove(e.row)}}},"取消授权")}}],tableData:[],loadingOrNoData:"数据加载中..."}},created:function(){this.debounceSearch=Object(c.debounce)(this.getList,this.$config.throttle_wait)},mounted:function(){this.channelId&&this.getManager()},watch:{channelId:function(){this.getManager()}},methods:{getList:function(t){var a=this,e=this.$config.apiDomain+"/sys/channels/"+this.channelId+"/auth/users",n={size:-1,q:t,status:0};this.isLoading=!0,""!==t&&this.$axios.get(e,{params:n}).then(function(t){var e=t.data;a.isLoading=!1,a.options=a.dealData(e.items)}).catch(function(t){a.isLoading=!1})},dealData:function(t){var a=[];return t&&t.map(function(t){a.push({label:t.name,value:t.email,id:t.user_id,email:t.email})}),a},getManager:function(){var t=this;this.loadingOrNoData="数据加载中...",this.isTableLoading=!0;var a=this.$config.apiDomain+"/sys/channels/"+this.channelId+"/auth";this.$axios.get(a,{params:{size:-1}}).then(function(a){var e=a.data;e.items.length||(t.loadingOrNoData="暂无数据"),t.isTableLoading=!1,t.tableData=e.items,t.total=e.total}).catch(function(){t.total=0,t.tableData=[],t.loadingOrNoData="数据加载失败",t.isTableLoading=!1})},addManager:function(t){var a=this;if(t){var e=JSON.parse(t).id,n=this.$config.apiDomain+"/sys/channels/"+this.channelId+"/auth";this.$axios.post(n,{role_id:"ROLE_C_ADMIN",user_id:e}).then(function(){a.checkedData="",a.$Message.success("已添加"),a.getManager()})}},remove:function(t){var a=this;this.$Modal.confirm({title:"确认取消授权此帐号？",content:"名称："+t.name+"<br><br>取消授权后，此账号将无法登陆当前渠道。",onOk:function(){a.delManager(t)}})},delManager:function(t){var a=this,e=t.user_id,n=this.$config.apiDomain+"/sys/channels/"+this.channelId+"/users/"+e;this.$axios.delete(n).then(function(){a.$Message.destroy(),a.$Message.success("已取消授权"),a.getManager()})}}},h={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"authorize-manager"},[e("edit-title",{attrs:{"is-show-btn":!1,title:"授权渠道管理员"}}),t._v(" "),e("div",{staticClass:"content common-card"},[e("Col",{staticClass:"select-wrapper"},[e("Select",{attrs:{filterable:"",remote:"",clearable:"","remote-method":function(a){return t.debounceSearch(a)},loading:t.isLoading,size:"large",placeholder:"请输入姓名/邮箱"},on:{"on-change":t.addManager},model:{value:t.checkedData,callback:function(a){t.checkedData=a},expression:"checkedData"}},t._l(t.options,function(a,n){return e("Option",{key:n,attrs:{value:'{"value": "'+a.email+'", "id": "'+a.id+'"}',label:a.label+a.email}},[e("span",[t._v(t._s(a.label))]),t._v(" "),e("span",{staticClass:"email"},[t._v(t._s(a.email))])])}))],1),t._v(" "),e("Col",{staticClass:"list-wrapper"},[e("h5",[t._v("已授权渠道管理员"),e("span",{staticClass:"tip"},[t._v("已添加 "+t._s(t.total)+" 人")])]),t._v(" "),e("Table",{staticClass:"smce-table-noscroll",attrs:{"no-data-text":t.loadingOrNoData,loading:t.isTableLoading,columns:t.columns,data:t.tableData}})],1)],1)],1)},staticRenderFns:[]};var u=e("VU/8")(d,h,!1,function(t){e("FZD+")},null,null).exports,m={name:"AddChannel",components:{editTitle:l.a},props:["isShowAddChannel"],data:function(){return{radioGroup:[],catalogArr:[],childObj:{},btnLoading:!1,formItem:{name:"",type:""},templateList:[],catalogName:"",childType:"",ruleForm:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{pattern:this.$config.reg_input.reg,message:this.$config.reg_input.msg,trigger:"blur"}],type:[{required:!0,message:"请选择渠道类型",trigger:"change"}]}}},created:function(){this.getType(),this.getTemplate()},methods:{getType:function(){var t=this,a=this.$config.apiDomain+"/sys/channels/type";this.$axios.get(a).then(function(a){var e=a.data;t.radioGroup=t.dealData(e),t.catalogArr=t.radioGroup.catalogArr,t.childObj=t.radioGroup.childObj})},getTemplate:function(){var t=this,a=this.$config.apiDomain+"/template/template_type";this.$axios.get(a).then(function(a){var e=a.data;t.templateList=e})},dealData:function(t){var a=[],e={},n=[],i=[];return t.forEach(function(t){var s=t.channel_catalog_name;s?i.indexOf(s)>-1?(n.push(t),e[s]=n):(i.push(s),a.push(t),n.push(t)):(t.channel_catalog_name=t.name,a.push(t))}),i.forEach(function(t){var a=n.filter(function(a){return a.channel_catalog_name===t});a.length&&(e[t]=a)}),{catalogArr:a,childObj:e}},addChannel:function(t){var a=this;this.btnLoading=!0;var e=this.$config.apiDomain+"/sys/channels";this.$axios.post(e,t).then(function(){a.btnLoading=!1,a.$Message.success("已添加"),a.$emit("add-channel",!1),a.$emit("get-data")}).catch(function(){a.btnLoading=!1})},getCatalogId:function(t){var a=this,e="";return t.forEach(function(t){t.channel_catalog_name===a.catalogName&&(e=t.code)}),e},commit:function(){var t=this;this.$refs.formArea.validate(function(a){if(a){var e=t.getCatalogId(t.catalogArr),n={channel_type_code:t.childType||e,name:t.formItem.name};t.addChannel(n)}})},cancel:function(){this.$emit("add-channel",!1)},handleCatalClick:function(t){this.catalogName=t,this.childType=this.childObj[t]&&this.childObj[t][0].code}}},g={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"add-channel"},[e("Form",{ref:"formArea",attrs:{"label-position":"left",model:t.formItem,rules:t.ruleForm,"label-width":60}},[e("edit-title",{attrs:{loading:t.btnLoading,title:"新建渠道数据集"},on:{"cancel-click":t.cancel,"ok-click":t.commit}}),t._v(" "),e("div",{staticClass:"custom-dialog-content"},[e("Card",{staticClass:"m24 p24",attrs:{"dis-hover":"",padding:0}},[e("FormItem",{staticClass:"name",attrs:{prop:"name",label:"名称"}},[e("Input",{staticClass:"name-input",attrs:{placeholder:"请输入渠道数据集名称",maxlength:20},model:{value:t.formItem.name,callback:function(a){t.$set(t.formItem,"name","string"==typeof a?a.trim():a)},expression:"formItem.name"}})],1),t._v(" "),e("FormItem",{staticClass:"type no-marginb",attrs:{prop:"type",label:"类型"}},[e("RadioGroup",{staticClass:"senior-radio",attrs:{type:"button"},on:{"on-change":t.handleCatalClick},model:{value:t.formItem.type,callback:function(a){t.$set(t.formItem,"type",a)},expression:"formItem.type"}},t._l(t.catalogArr,function(a){return e("Radio",{key:a.code,staticStyle:{"border-radius":"0"},attrs:{label:a.channel_catalog_name}},[e("i",{class:a.icon_type}),t._v("\n                            "+t._s(a.channel_catalog_name)+"\n                        ")])}))],1),t._v(" "),e("FormItem",{staticClass:"no-marginb"},[t.childObj[t.catalogName]&&t.childObj[t.catalogName]?e("RadioGroup",{staticClass:"junior-radio",attrs:{type:"button",size:"small"},model:{value:t.childType,callback:function(a){t.childType=a},expression:"childType"}},t._l(t.childObj[t.formItem.type],function(a){return e("Radio",{key:a.code,staticStyle:{"border-radius":"0"},attrs:{label:a.code}},[t._v(t._s(a.name))])})):t._e()],1)],1)],1)],1)],1)},staticRenderFns:[]};var _={name:"ChannelTable",components:{Pagination:r,AddChannel:e("VU/8")(m,g,!1,function(t){e("V5qm")},null,null).exports,AuthorizeManager:u},data:function(){var t=this;return{totalCount:0,isShowInput:!1,columnIndex:"",currentPage:1,channelId:"",columns:[{title:"渠道名称",key:"name",width:300,render:function(a,e){return a("span",[a("span",{style:{display:t.isShowInput&&t.columnIndex===e.index?"none":"inline-block"}},e.row.name),a("i-input",{props:{value:e.row.name,maxlength:20,placeholder:"请输入渠道数据集名称"},attrs:{id:"input"+e.index},style:{width:"80%",display:t.isShowInput&&t.columnIndex===e.index?"inline-block":"none"}}),a("Icon",{props:{type:"md-create",size:"16"},style:{display:t.isShowInput&&t.columnIndex===e.index?"none":"inline-block"},class:{"icon-shape":!0},on:{click:function(a){t.edit(a,e)}}}),a("Icon",{props:{type:"md-close",size:"18"},style:{display:t.isShowInput&&t.columnIndex===e.index?"inline-block":"none",position:"relative",top:"7px"},class:{"icon-shape":!0},on:{click:function(){t.cancelSaveData(e)}}}),a("Icon",{props:{type:"md-checkmark",size:"18"},style:{display:t.isShowInput&&t.columnIndex===e.index?"inline-block":"none",position:"relative",top:"7px"},class:{"icon-shape":!0},on:{click:function(a){t.saveData(a,e)}}})])}},{title:"渠道类型",key:"channel_type_name"},{title:"渠道ID",key:"channel_id",tooltip:!0},{title:"事件总数",key:"event_count",render:function(t,a){return t("span",a.row.event_count+" 个事件")}},{title:"授权渠道管理员",key:"auth_count",align:"center",render:function(a,e){return a("a",{on:{click:function(){t.authChannel(e)}}},0===e.row.auth_count?"未授权":"已授权"+e.row.auth_count+"位")}},{title:"操作",align:"center",render:function(a,e){return a("a",{on:{click:function(){t.remove(e.row)}}},"删除")}}],tableData:[],isLoading:!0,isShowAddChannel:!1,isShowAuthManager:!1,tablePage:this.$config.table_page,loadingOrNoData:"数据加载中..."}},created:function(){this.getData();var t=this.$config.debounce_wait;this.debounceGetData=this.$lodash.debounce(this.getData,t)},methods:{addChannel:function(t){this.isShowAddChannel=t},authChannel:function(t){this.channelId=t.row.channel_id,this.isShowAuthManager=!0},getData:function(t){var a=this;this.loadingOrNoData="数据加载中...",this.isShowInput=!1,this.isLoading=!0,this.currentPage=t;var e=this.$config.apiDomain+"/sys/channels",n=this.tablePage;t&&(n=i()({},n,{page:t})),this.$axios.get(e,{params:n}).then(function(t){var e=t.data;e.items.length||(a.loadingOrNoData="暂无数据"),a.tableData=e.items,a.totalCount=e.total,a.isLoading=!1}).catch(function(){a.tableData=[],a.totalCount=0,a.loadingOrNoData="数据加载失败",a.isLoading=!1})},edit:function(t,a){this.isShowInput=!0,this.columnIndex=a.index,this.inputFocus(a)},inputFocus:function(t){var a=this,e=t.index;this.$nextTick(function(){var n=document.getElementById("input"+e).getElementsByTagName("input")[0];n.value=t.row.name,n.focus(),a.$tools.moveToEnd(n)})},saveData:function(t,a){var e=this;this.$nextTick(function(){var t=document.getElementById("input"+a.index).getElementsByTagName("input")[0].value,n=a.row.name;e.judgeEditData(a.row,n,t)})},judgeEditData:function(t,a,e){if(e){if(!this.$config.reg_input.reg.test(e))return this.$Message.destroy(),void this.$Message.error({content:this.$config.reg_input.msg,duration:5});if(a===e)return void(this.isShowInput=!1);t.newName=e,this.editData(t)}else this.$Message.destroy(),this.$Message.error("请输入名称")},editData:function(t){var a=this,e=t.channel_id,n=t.newName,i=this.$config.apiDomain+"/sys/channels/"+e,s={name:n};this.$axios.put(i,s).then(function(){a.isShowInput=!1,a.$set(t,"name",n),a.$Message.success("已修改")}).catch(function(){a.isShowInput=!0})},cancelSaveData:function(t){document.getElementById("input"+t.index).getElementsByTagName("input")[0].value=t.row.name,this.isShowInput=!1},remove:function(t){var a=this,e=t.channel_id,n=t.name;this.$Modal.confirm({title:"确认删除此渠道？",content:"名称："+n+"<br><br>删除后将无法恢复。",onOk:function(){a.deleteData(e)}})},deleteData:function(t){var a=this,e=this.$config.apiDomain+"/sys/channels/"+t;this.$axios.delete(e).then(function(){a.$Message.destroy(),a.$Message.success("已删除"),a.getData(a.currentPage)})}},watch:{isShowAuthManager:function(){!this.isShowAuthManager&&this.getData(this.currentPage)}}},p={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Card",{staticClass:"channel-table",attrs:{"dis-hover":"",padding:0}},[e("Row",{staticClass:"padding16-18",attrs:{type:"flex",justify:"end"}},[e("Col",[e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:function(a){t.addChannel(!0)}}},[t._v("新建渠道数据集")])],1)],1),t._v(" "),e("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{"no-data-text":t.loadingOrNoData,loading:t.isLoading,columns:t.columns,data:t.tableData}}),t._v(" "),e("div",{staticClass:"padding16-18"},[t.totalCount>10?e("Pagination",{attrs:{total:t.totalCount,current:t.currentPage},on:{"get-data":t.debounceGetData}}):t._e()],1),t._v(" "),e("Drawer",{attrs:{width:"750","mask-closable":!1},model:{value:t.isShowAddChannel,callback:function(a){t.isShowAddChannel=a},expression:"isShowAddChannel"}},[t.isShowAddChannel?e("add-channel",{attrs:{isShowAddChannel:t.isShowAddChannel},on:{"add-channel":t.addChannel,"get-data":t.getData}}):t._e()],1),t._v(" "),e("Drawer",{attrs:{width:"750","mask-closable":!1},model:{value:t.isShowAuthManager,callback:function(a){t.isShowAuthManager=a},expression:"isShowAuthManager"}},[t.isShowAuthManager?e("authorize-manager",{attrs:{isShowAuthManager:t.isShowAuthManager,channelId:t.channelId}}):t._e()],1)],1)},staticRenderFns:[]};var f=e("VU/8")(_,p,!1,function(t){e("mW7+")},null,null).exports,v=e("Dd8w"),b=e.n(v),C=e("d32x"),y={props:{drawerType:{type:String,default:""},editChannel:{type:Object,default:null}},data:function(){return{source_trait_error:!1,target_trait_error:!1,channelList:[],add_source_trait:{},add_target_trait:{},source_traitData:{publicTrait:!0,value:{}},target_traitData:{publicTrait:!0,value:{}},formValidate:{source_channel_code:"",target_channel_code:"",source_channel_name:"",target_channel_name:""},mapping_code:"",ruleValidate:{source_channel_code:[{required:!0,message:"请选择资源渠道",trigger:"change"}],target_channel_code:[{required:!0,message:"请选择目标渠道",trigger:"change"}]},SOURCE_URI:{},TARGET_URI:{},dataBack:{},source_disabled:!0,target_disabled:!0}},computed:{isdisabled:function(){return"edit"==this.drawerType},hasChanged:function(){return this.$lodash.isEqual(b()({},this.formValidate,{add_source_trait:this.add_source_trait.value,add_target_trait:this.add_target_trait.value}),this.dataBack)}},components:{EditTitle:l.a,TraitInput:C.a},mounted:function(){this.init(),this.dataBack=this.$lodash.cloneDeep(b()({},this.formValidate,{add_source_trait:this.add_source_trait.value,add_target_trait:this.add_target_trait.value}))},methods:{init:function(){this.getChannel(),this.isChannel()},getChannel:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/sys/channels?size=-1").then(function(a){var e=a.data;e.items.forEach(function(t){t.label=t.name,t.value=t.channel_id}),t.channelList=e.items}).catch(function(){t.btnLoading=!1})},isChannel:function(){"edit"===this.drawerType?(this.source_disabled=!1,this.target_disabled=!1,this.add_source_trait={names:[this.editChannel.mappings[0].trait_name],value:[this.editChannel.mappings[0].trait_code],source:"trait"},this.add_target_trait={names:[this.editChannel.mappings[1].trait_name],value:[this.editChannel.mappings[1].trait_code],source:"trait"},this.formValidate.source_channel_code=this.editChannel.mappings[0].channel_code,this.formValidate.target_channel_code=this.editChannel.mappings[1].channel_code,this.mapping_code=this.editChannel.mapping_code,this.addSOURCE_URI(),this.addTARGET_URI()):this.formValidate={}},changeSourceChannel:function(t){this.add_source_trait={},this.formValidate.source_channel_name=t.label,this.formValidate.source_channel_name&&(this.source_disabled=!1,this.addSOURCE_URI())},changeTargetChannel:function(t){this.add_target_trait={},this.formValidate.target_channel_name=t.label,this.formValidate.target_channel_name&&(this.target_disabled=!1,this.addTARGET_URI())},addSOURCE_URI:function(){this.SOURCE_URI={traits:this.$config.apiDomain+"/traits/channel/"+this.formValidate.source_channel_code,traitsParams:{channel_code:this.formValidate.source_channel_code,lifecycle_status:"active",data_type:"String",authorized:!1},catalogs:this.$config.apiDomain+"/catalogs/channel/"+this.formValidate.source_channel_code,catalogsParams:{authorized:!1},search:this.$config.apiDomain+"/searcher/traits-and-crowds/channel_code/"+this.formValidate.source_channel_code,searchParams:{lifecycle_status:"active",data_type:"String",authorized:!1}}},addTARGET_URI:function(){this.TARGET_URI={traits:this.$config.apiDomain+"/traits/channel/"+this.formValidate.target_channel_code,traitsParams:{channel_code:this.formValidate.target_channel_code,lifecycle_status:"active",data_type:"String",authorized:!1},catalogs:" "+this.$config.apiDomain+"/catalogs/channel/"+this.formValidate.target_channel_code,catalogsParams:{authorized:!1},search:" "+this.$config.apiDomain+"/searcher/traits-and-crowds/channel_code/"+this.formValidate.target_channel_code,searchParams:{lifecycle_status:"active",data_type:"String",authorized:!1}}},cancel:function(){this.$emit("cancelAddAssociated",!1)},ok:function(){var t=this;this.$refs.formValidate.validate(function(a){if(t.add_source_trait.names||(t.source_trait_error=!0,a=!1),t.add_target_trait.names||(t.target_trait_error=!0,a=!1),a){if(t.formValidate.source_channel_code===t.formValidate.target_channel_code)return t.$Message.destroy(),void t.$Message.error("渠道1和渠道2不能相同");if("edit"===t.drawerType){var e=[{channel_code:t.formValidate.source_channel_code,trait_code:t.add_source_trait.value[0]},{channel_code:t.formValidate.target_channel_code,trait_code:t.add_target_trait.value[0]}];t.$axios.put(t.$config.apiDomain+"/id-mappings/"+t.mapping_code,e).then(function(){t.$tools.bus.$emit("updateChannelList",!0),t.$emit("submitAddAssociated",!1),t.$Message.destroy(),t.$Message.success("已修改")})}else{var n=[];n[0]={channel_code:t.formValidate.source_channel_code,channel_name:t.formValidate.source_channel_name,trait_code:t.add_source_trait.value[0],trait_name:t.add_source_trait.names[0]},n[1]={channel_code:t.formValidate.target_channel_code,channel_name:t.formValidate.target_channel_name,trait_code:t.add_target_trait.value[0],trait_name:t.add_target_trait.names[0]},t.$axios.post(t.$config.apiDomain+"/id-mappings",n).then(function(){t.$tools.bus.$emit("updateChannelList",!0),t.$emit("submitAddAssociated",!1),t.$Message.destroy(),t.$Message.success("已添加")})}}})},updateSourceTrait:function(t){this.add_source_trait=this.$lodash.cloneDeep(t),this.source_trait_error=!1},updateTargetTrait:function(t){this.add_target_trait=this.$lodash.cloneDeep(t),this.target_trait_error=!1}},watch:{},destroyed:function(){}},w={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mask-bg"},[e("edit-title",{attrs:{disabled:t.hasChanged,title:"edit"==t.drawerType?"修改渠道关联":"新建渠道关联"},on:{"cancel-click":t.cancel,"ok-click":t.ok}}),t._v(" "),e("div",{staticClass:"custom-dialog-content"},[e("Card",{staticClass:"m24",attrs:{"dis-hover":"",padding:0}},[e("p",{attrs:{slot:"title"},slot:"title"},[e("span",[t._v("基本信息")]),t._v(" "),e("span",{staticClass:"title-des"},[t._v("（请先选择渠道，再选择特性）")])]),t._v(" "),e("Form",{ref:"formValidate",staticClass:"mt24",staticStyle:{padding:"0 24px"},attrs:{"label-position":"left","label-width":110,model:t.formValidate,rules:t.ruleValidate}},[e("Form-item",{attrs:{label:"渠道一",prop:"source_channel_code"}},[e("Select",{attrs:{disabled:t.isdisabled,"label-in-value":!0,placeholder:"请选择资源渠道"},on:{"on-change":t.changeSourceChannel},model:{value:t.formValidate.source_channel_code,callback:function(a){t.$set(t.formValidate,"source_channel_code",a)},expression:"formValidate.source_channel_code"}},t._l(t.channelList,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}))],1),t._v(" "),e("Form-item",{staticClass:"diy_star",class:{"diy-form-item-error":t.source_trait_error},attrs:{label:"渠道一特性"}},[e("TraitInput",t._b({staticClass:"touch_trait",attrs:{placeholder:"请选择特性",URI:t.SOURCE_URI,disabled:t.source_disabled,value:t.add_source_trait},on:{"on-change":t.updateSourceTrait}},"TraitInput",t.source_traitData,!1)),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.source_trait_error,expression:"source_trait_error"}],staticClass:"ivu-form-item-error-tip"},[t._v("请选择资源特性")])],1),t._v(" "),e("Form-item",{attrs:{label:"渠道二",prop:"target_channel_code"}},[e("Select",{attrs:{disabled:t.isdisabled,"label-in-value":!0,placeholder:"请选择资源渠道"},on:{"on-change":t.changeTargetChannel},model:{value:t.formValidate.target_channel_code,callback:function(a){t.$set(t.formValidate,"target_channel_code",a)},expression:"formValidate.target_channel_code"}},t._l(t.channelList,function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])}))],1),t._v(" "),e("Form-item",{staticClass:"diy_star",class:{"diy-form-item-error":t.target_trait_error},attrs:{label:"渠道二特性"}},[e("TraitInput",t._b({staticClass:"touch_trait",attrs:{placeholder:"请选择特性",URI:t.TARGET_URI,disabled:t.target_disabled,value:t.add_target_trait},on:{"on-change":t.updateTargetTrait}},"TraitInput",t.target_traitData,!1)),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.target_trait_error,expression:"target_trait_error"}],staticClass:"ivu-form-item-error-tip"},[t._v("请选择目标特性")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var $={props:{},data:function(){var t=this;return{drawerTitle:"",drawerType:"",editChannel:null,isLoading:!0,columns:[{title:"渠道一",key:"source_channel",ellipsis:!0,tooltip:!0},{title:"渠道一特性",key:"source_channel_trait",ellipsis:!0,tooltip:!0},{title:"渠道二",key:"target_channel",ellipsis:!0,tooltip:!0},{title:"渠道二特性",key:"target_channel_trait",ellipsis:!0,tooltip:!0},{title:"最近关联日期",key:"update_time",ellipsis:!0,tooltip:!0,render:function(a,e){return a("span",e.row.update_time?t.$date(+(""+e.row.update_time)).format("YYYY-MM-DD HH:mm:ss"):" ")}},{title:"操作",width:150,render:function(a,e){return a("div",[a("a",{style:{},on:{click:function(){t.editButton(e.index,e.row)}}},"修改"),a("a",{style:{padding:"0 8px"},on:{click:function(){t.delButton(e.index,e.row)}}},"删除")])}}],tableData:[],isShowAddAssociated:!1,loadingOrNoData:"数据加载中..."}},computed:{},components:{AddAssociated:e("VU/8")(y,w,!1,function(t){e("fl67"),e("/BE9")},"data-v-99847504",null).exports},mounted:function(){var t=this;this.$tools.bus.$on("updateChannelList",function(a){a&&t.getData()}),this.init()},methods:{init:function(){this.getData()},getData:function(){var t=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0,this.$axios.get(this.$config.apiDomain+"/id-mappings?size=-1").then(function(a){var e=a.data;e.items.length||(t.loadingOrNoData="暂无数据"),e.items.forEach(function(t){t.source_channel=t.mappings[0].channel_name,t.source_channel_trait=t.mappings[0].trait_name,t.target_channel=t.mappings[1].channel_name,t.target_channel_trait=t.mappings[1].trait_name}),t.tableData=e.items,t.isLoading=!1}).catch(function(){t.tableData=[],t.loadingOrNoData="数据加载失败",t.isLoading=!1})},editButton:function(t,a){this.drawerType="edit",this.editChannel=a,this.isShowAddAssociated=!0},delButton:function(t,a){var e=this;this.$Modal.confirm({title:"确认删除此渠道关联？",content:"名称："+a.mappings[0].channel_name+"-"+a.mappings[1].channel_name+"<br></br>删除后将无法恢复。",onOk:function(){e.$axios.delete(e.$config.apiDomain+"/id-mappings/"+a.mapping_code).then(function(){e.$Message.destroy(),e.$Message.success("已删除"),e.getData()})},onCancel:function(){}})},addChannel:function(){this.drawerType="add",this.isShowAddAssociated=!0},cancel:function(t){this.isShowAddAssociated=t},ok:function(){this.isShowAddAssociated=!1,this.getData()}},watch:{},destroyed:function(){},beforeDestroy:function(){this.$tools.bus.$off("updateChannelList")}},D={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Card",{staticClass:"channel-associated",attrs:{"dis-hover":"",padding:0}},[e("Row",{staticClass:"padding16-18",attrs:{type:"flex",justify:"end"}},[e("Col",[e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:function(a){t.addChannel(!0)}}},[t._v("新建渠道关联")])],1)],1),t._v(" "),e("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{"no-data-text":t.loadingOrNoData,loading:t.isLoading,columns:t.columns,data:t.tableData}}),t._v(" "),e("Drawer",{attrs:{width:"750","mask-closable":!1},model:{value:t.isShowAddAssociated,callback:function(a){t.isShowAddAssociated=a},expression:"isShowAddAssociated"}},[t.isShowAddAssociated?e("add-associated",{attrs:{drawerTitle:t.drawerTitle,drawerType:t.drawerType,editChannel:t.editChannel},on:{cancelAddAssociated:t.cancel,submitAddAssociated:t.ok}}):t._e()],1)],1)},staticRenderFns:[]};var I={name:"ChannelManage",data:function(){return{activeName:"ChannelTable"}},created:function(){this.debounceTab=this.$lodash.debounce(this.tabChange,this.$config.debounce_wait)},mounted:function(){},methods:{tabChange:function(t){this.activeName=t}},watch:{},destroyed:function(){},components:{ChannelTable:f,ChannelAssociated:e("VU/8")($,D,!1,function(t){e("2wEE")},"data-v-7b776ee2",null).exports}},k={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"channel-manage page-warpper"},[e("div",{staticClass:"page-title bottom-shadow page-title-tab"},[e("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":t.activeName},on:{"on-select":t.debounceTab}},[e("MenuItem",{attrs:{name:"ChannelTable"}},[t._v("渠道数据集")]),t._v(" "),e("MenuItem",{directives:[{name:"role-button",rawName:"v-role-button",value:"create_channel_mapping",expression:"`create_channel_mapping`"}],attrs:{name:"ChannelAssociated"}},[t._v("渠道关联")])],1)],1),t._v(" "),e("div",{staticClass:"page-content page-content-tab container-padding24"},[e(t.activeName,{tag:"component",attrs:{name:t.activeName}})],1)])},staticRenderFns:[]};var T=e("VU/8")(I,k,!1,function(t){e("DDGZ")},"data-v-5a19db74",null);a.default=T.exports},DDGZ:function(t,a){},"FZD+":function(t,a){},"GM/D":function(t,a){},V5qm:function(t,a){},fl67:function(t,a){},"mW7+":function(t,a){}});