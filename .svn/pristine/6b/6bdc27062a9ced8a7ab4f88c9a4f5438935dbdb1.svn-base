webpackJsonp([19],{"4/xz":function(t,e){},JD5G:function(t,e,a){"use strict";var i=a("//Fk"),r=a.n(i),n=a("CFN8"),s={data:function(){return{saveBtnStatus:!1,groupId:"",selectLeaderData:[],leaderData:"",changedLeader:"",selectMemberData:[],memberData:[],changedMember:[],formValidate:{name:"",groupMember:[]},ruleValidate:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{pattern:this.$config.reg_input.reg,message:this.$config.reg_input.msg,trigger:"blur"}],groupLeader:[{required:!0,message:"请选择一个责任人",trigger:"change"}]},dataBack:{}}},props:{titleName:{type:String,default:"添加运营组"},groupInfo:{type:Object,default:function(){return{}}},orgInfo:{type:Object,default:function(){return{}}},isOperSpe:{type:Boolean,default:!1}},components:{editTitle:n.a},computed:{hasChanged:function(){return this.$lodash.isEqual(this.formValidate,this.dataBack)}},methods:{getGroupLeader:function(t){-1!==this.changedMember.indexOf(t)?(this.$Message.destroy(),this.$Message.error({content:"该成员已被设为组员",duration:3})):(this.formValidate.groupLeader=t,this.changedLeader=t)},getGroupMember:function(t){this.formValidate.groupMember=t,this.changedMember=t,this.getMemberVal()},cancelEdit:function(){this.$emit("show-drawer",!1)},okEdit:function(){this.handleSubmit("formValidate")},getLeaderData:function(){var t="/sys/groups/channel-leaders";return this.orgInfo.org_id&&(t="/sys/groups/"+this.orgInfo.org_id+"/org-leaders"),this.isOperSpe?new r.a(function(t){t()}):this.$axios.get(""+this.$config.apiDomain+t,{params:{size:-1}})},getMemberData:function(){var t="/sys/orgs/"+this.$config.login_info.auth_info.org_id+"/org-members";return this.$axios.get(""+this.$config.apiDomain+t,{params:{size:-1}})},getCondition:function(){var t=this,e=this.$config.login_info.user_info.user_id;this.$axios.all([this.getMemberData()]).then(this.$axios.spread(function(a){if(a&&a.data.items.forEach(function(e){t.selectMemberData.push({name:e.name,label:e.username,value:e.user_id})}),t.groupInfo.name)t.groupId=t.groupInfo.groupId,t.formValidate.name=t.groupInfo.name,t.formValidate.groupLeader=t.groupInfo.leaderId,t.formValidate.groupMember=t.groupInfo.groupMembersArr,t.getMemberVal();else if(t.isOperSpe){var i=t.$config.login_info.user_info.user_id;t.formValidate.groupLeader=i}t.groupInfo.name||(t.formValidate.groupMember=[e]),t.changedMember=t.formValidate.groupMember,t.dataBack=t.$lodash.cloneDeep(t.formValidate)}))},getMemberVal:function(){var t=this,e=this.selectMemberData.filter(function(e){return-1!==t.formValidate.groupMember.indexOf(e.value)});this.memberData=e},editGroup:function(){var t=this,e=this.formValidate,a="",i="";this.groupInfo.name?(a="put",i="已修改"):(a="post",i="已添加");var r=this.memberData.map(function(t){return{user_id:t.value}}),n={group_id:this.groupId||void 0,name:e.name,group_members:r};this.$axios({method:a,url:this.$config.apiDomain+"/sys/groups",data:n}).then(function(){t.updateList(i)}).catch(function(){t.saveBtnStatus=!1})},updateList:function(t){this.saveBtnStatus=!1,this.cancelEdit(),this.$Message.destroy(),this.$Message.success(t),this.$tools.bus.$emit("updateGroupList")},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t?(e.saveBtnStatus=!0,e.editGroup()):e.saveBtnStatus=!1})}},mounted:function(){this.getCondition()}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"slide-create-box"},[a("edit-title",{attrs:{loading:t.saveBtnStatus,disabled:t.hasChanged,title:t.titleName},on:{"cancel-click":t.cancelEdit,"ok-click":t.okEdit}}),t._v(" "),a("div",{staticClass:"slide-scroll-box"},[a("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate}},[a("div",{staticClass:"dialog-padding20"},[a("Card",{attrs:{"dis-hover":""}},[a("div",{staticClass:"form-title"},[t._v("运营组名称")]),t._v(" "),a("Form-item",{staticClass:"mb10",attrs:{prop:"name"}},[a("Input",{staticClass:"width400",attrs:{maxlength:20,placeholder:"请输入运营组名称"},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name","string"==typeof e?e.trim():e)},expression:"formValidate.name"}})],1)],1),t._v(" "),a("Card",{staticClass:"mt20",attrs:{"dis-hover":""}},[a("div",{staticClass:"form-title"},[t._v("运营组成员")]),t._v(" "),a("Form-item",{staticClass:"mb10"},[a("Select",{staticClass:"width400",attrs:{placeholder:"请选择组员",multiple:"",filterable:""},on:{"on-change":t.getGroupMember},model:{value:t.formValidate.groupMember,callback:function(e){t.$set(t.formValidate,"groupMember",e)},expression:"formValidate.groupMember"}},t._l(t.selectMemberData,function(e){return a("Option",{key:e.value,attrs:{value:e.value,label:e.name}},[a("span",[t._v(t._s(e.name))]),t._v(" "),a("span",{staticClass:"name-email"},[t._v(t._s(e.label))])])}))],1)],1)],1)])],1)],1)},staticRenderFns:[]};var u=a("VU/8")(s,o,!1,function(t){a("vXY3")},"data-v-24550fb0",null).exports,d=a("txAQ"),l={data:function(){var t=this;this.$createElement;return{showEidt:!1,titleName:"",groupInfo:{},currentPage:1,pageSize:10,total:0,loadingOrNoData:"数据加载中...",isLoading:!1,searInput:"",selectTransferData:[],gridList:{columns:[{title:"运营组名称",key:"name",ellipsis:!0,tooltip:!0},{title:"组成员",key:"groupMembersStr",ellipsis:!0,tooltip:!0},{title:"修改人",key:"updateName",ellipsis:!0,tooltip:!0},{title:"修改时间",key:"updateTime",width:180},{title:"操作",key:"action",width:180,render:function(e,a){return e("div",[e("div",[e("a",{on:{click:function(){return t.creatGroup(a.row)}}},["修改"]),e("a",{style:"margin: 0 10px",on:{click:function(){return t.confirmDelete(a.row)}}},["删除"]),e(d.a,{attrs:{type:"group",orginInfo:a.row,selectData:t.selectTransferData}})])])}}],data:[]}}},props:{orgInfo:{type:Object,default:function(){return{}}},isOperSpe:{type:Boolean,default:!1}},created:function(){this.debounceSearch=this.$lodash.debounce(this.searIconClick,this.$config.debounce_wait),this.getTransferData()},mounted:function(){var t=this;this.$tools.bus.$on("updateGroupList",function(){t.searInput="",t.currentPage=1,t.getData()})},beforeDestroy:function(){this.$tools.bus.$off("updateGroupList")},components:{addGroup:u},methods:{showDrawer:function(t){this.showEidt=t},searIconClick:function(){this.currentPage=1,this.getData()},creatGroup:function(t){this.titleName=t.groupId?"修改运营组":"新建运营组",this.groupInfo=t,this.showEidt=!0},getTransferData:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/sys/groups?size=-1").then(function(e){var a=e.data;t.selectTransferData=a.items.map(function(t){return{name:t.name,value:t.group_id}}),t.getData()}).catch(function(){t.selectTransferData=[]})},confirmDelete:function(t){var e=this;this.$Modal.confirm({title:"确认删除此运营组？",content:"名称："+t.name+"<br><br>删除后将无法恢复。",onOk:function(){e.deleteGroup(t.groupId)}})},deleteGroup:function(t){var e=this,a="/sys/groups/"+t;this.$axios.delete(""+this.$config.apiDomain+a,{}).then(function(){e.$Message.success("已删除"),e.currentPage>1&&1==e.gridList.data.length&&e.currentPage--,e.getData()})},getData:function(){var t=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0;var e={q:this.searInput,page:this.currentPage,rows:this.pageSize};this.$axios.get(this.$config.apiDomain+"/sys/groups",{params:e}).then(function(e){var a=e.data;t.isLoading=!1,a.items.length||(t.loadingOrNoData="暂无数据"),t.gridList.data=t.clearData(a.items),t.total=a.total}).catch(function(){t.total=0,t.gridList.data=[],t.loadingOrNoData="数据加载失败",t.isLoading=!1})},clearData:function(t){var e=this,a=[];return t.forEach(function(t){var i=[],r=[];for(var n in t.group_members)r.push(t.group_members[n].user_id),i.push(t.group_members[n].name);a.push({updateTime:t.create_time?e.$date(+t.update_time).format("YYYY-MM-DD HH:mm:ss"):"-",id:t.group_id,groupId:t.group_id,groupMembers:t.group_members,groupMembersArr:r,groupMembersStr:i.join("，"),leaderId:t.leader_id,updateName:t.updater_name,name:t.name})}),a},pageChange:function(t){this.currentPage=t,this.getData()}},watch:{orgInfo:function(){this.searInput="",this.currentPage=1,this.getData()}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{staticClass:"m24",attrs:{"dis-hover":"",padding:0}},[a("Row",{staticClass:"padding16-18"},[a("Col",{attrs:{span:"16"}},[a("Input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"请输入运营组名称"},on:{"on-change":t.debounceSearch},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.debounceSearch(e):null}},model:{value:t.searInput,callback:function(e){t.searInput=e},expression:"searInput"}}),t._v(" "),a("span",{staticClass:"total-count"},[t._v("共"),a("i",[t._v(t._s(t.total))]),t._v("个运营组")])],1),t._v(" "),a("Col",{staticStyle:{"text-align":"right"},attrs:{span:"8"}},[a("Button",{attrs:{icon:"md-add",type:"primary"},on:{click:function(e){t.creatGroup({})}}},[t._v("新建运营组")])],1)],1),t._v(" "),a("Row",[a("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.isLoading,"no-data-text":t.loadingOrNoData,columns:t.gridList.columns,data:t.gridList.data}}),t._v(" "),a("Row",{staticClass:"pageRow padding16-18",attrs:{type:"flex",justify:"end"}},[a("Page",{attrs:{total:t.total,current:t.currentPage,"show-elevator":""},on:{"on-change":t.pageChange}})],1)],1),t._v(" "),a("Drawer",{attrs:{width:"600","mask-closable":!1},model:{value:t.showEidt,callback:function(e){t.showEidt=e},expression:"showEidt"}},[t.showEidt?a("addGroup",{attrs:{orgInfo:t.orgInfo,isOperSpe:t.isOperSpe,titleName:t.titleName,groupInfo:t.groupInfo},on:{"show-drawer":t.showDrawer}}):t._e()],1)],1)},staticRenderFns:[]};var g=a("VU/8")(l,c,!1,function(t){a("4/xz")},"data-v-7e3e988d",null);e.a=g.exports},hDKX:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={data:function(){return{}},components:{group:a("JD5G").a},mounted:function(){},methods:{}},r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":"insight"}},[e("MenuItem",{attrs:{name:"insight"}},[this._v("运营组")])],1),this._v(" "),e("div",{staticClass:"container-padding10"},[e("Card",{attrs:{"dis-hover":""}},[e("group",{attrs:{isOperSpe:!0}})],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(i,r,!1,function(t){a("l5gm")},"data-v-11e75aa7",null);e.default=n.exports},l5gm:function(t,e){},vXY3:function(t,e){}});