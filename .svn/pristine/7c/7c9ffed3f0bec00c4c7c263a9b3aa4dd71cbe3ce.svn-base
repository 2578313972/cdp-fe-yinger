webpackJsonp([26],{DUl7:function(t,a){},Qlcn:function(t,a){},ZAXZ:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});e("VaHO");var i=e("woOf"),n=e.n(i),s={data:function(){return{auditList:[]}},components:{editTitle:e("CFN8").a},mounted:function(){this.getAuditConList()},methods:{getAuditConList:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/api/audit/query-configs",{}).then(function(a){var e=a.data;t.auditList=t.clearData(e)})},clearData:function(t){var a=this;return t.map(function(t){var e=t.operate_types.map(function(t){return a.$config.status_config[t]}),i=t.stages.map(function(t){return t=n()(t,{loading:!1})});return{type:e.join(", "),name:a.$config.status_config[t.review_type],stages:i}})},changeStatus:function(t,a){var e=this;a.loading=!0;var i="/api/audit/update-config?id="+a.id+"&enabled="+t;this.$axios.put(""+this.$config.apiDomain+i).then(function(){a.loading=!1,a.enabled=t,e.$Message.destroy();var i=t?"已开启":"已关闭";e.$Message.success(i)}).catch(function(){a.loading=!1,a.enabled=!t})}}},o={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"mask-bg"},[e("edit-title",{attrs:{isShowBtn:!1,title:"审核控制"}}),t._v(" "),e("div",{staticClass:"custom-dialog-content"},[e("div",{staticClass:"dialog-padding20"},[e("Card",{staticClass:"item-box",attrs:{"dis-hover":""}},[e("Row",{staticStyle:{"font-weight":"bold"}},[e("Col",{attrs:{span:"14"}},[e("span",{staticClass:"pl5"},[t._v("私有/运营组资源审核")])]),t._v(" "),e("Col",{attrs:{span:"5"}},[e("span",[t._v("节点初审")])]),t._v(" "),e("Col",{attrs:{span:"5"}},[e("span",[t._v("渠道内审")])])],1),t._v(" "),e("Divider",{staticStyle:{margin:"16px 0"}}),t._v(" "),t._l(t.auditList,function(a,i){return e("Row",{key:i,staticClass:"mt20"},[e("Col",{attrs:{span:"14"}},[e("span",{staticClass:"pl5"},[t._v(t._s(a.name)+"（"+t._s(a.type)+"）")])]),t._v(" "),t._l(a.stages,function(a){return e("Col",{key:a.id,attrs:{span:"5"}},[e("i-switch",{attrs:{loading:a.loading},on:{"on-change":function(e){t.changeStatus(e,a)}},model:{value:a.enabled,callback:function(e){t.$set(a,"enabled",e)},expression:"stage.enabled"}},[e("span",{attrs:{slot:"open"},slot:"open"},[t._v("开")]),t._v(" "),e("span",{attrs:{slot:"close"},slot:"close"},[t._v("关")])])],1)})],2)})],2)],1)])],1)},staticRenderFns:[]};var r={data:function(){var t=this;return{isShowBtn:!0,statusConfig:this.$config.status_config,showDetail:!1,showAuditController:!1,auditId:"",searInput:"",buttonActive:"all",currentPage:1,pageSize:10,total:0,loadingOrNoData:"数据加载中...",isLoading:!1,gridList:{columns:[{title:"审核内容",key:"title",ellipsis:!0,tooltip:!0},{title:"名称",key:"res_name",ellipsis:!0,tooltip:!0},{title:"审核状态",key:"status",width:150,render:function(a,e){return a("div",[a("span",{style:{color:{rejected:"#ed4014",pass:"#19be6b",pending:""}[e.row.status]}},t.statusConfig[e.row.status])])}},{title:"申请人",key:"submiter_name",ellipsis:!0,tooltip:!0},{title:"提交时间",key:"create_time",width:200},{title:"操作",key:"action",width:200,render:function(a,e){var i="pass"==e.row.status||"rejected"==e.row.status;return a("div",[a("a",{on:{click:function(){t.detailAudit(e.row.id)}}},"详情"),a("a",{style:i?{"margin-left":"10px",color:"#999",cursor:"not-allowed"}:{"margin-left":"10px"},on:{click:function(){i||t.actionAudit(e,"rejected")}}},"拒绝"),a("a",{style:i?{"margin-left":"10px",color:"#999",cursor:"not-allowed"}:{"margin-left":"10px"},on:{click:function(){i||t.actionAudit(e,"pass")}}},"通过")])}}],data:[]}}},components:{auditController:e("VU/8")(s,o,!1,function(t){e("Qlcn")},null,null).exports,auditDetail:e("FNo+").a},created:function(){var t=this.$config,a=this.$config.debounce_wait,e=t.login_info.role_id;this.isShowBtn="ROLE_C_ADMIN"===e,this.debounceSearch=this.$lodash.debounce(this.searIconClick,a),this.debounceActive=this.$lodash.debounce(this.activeFn,a),this.debouncePage=this.$lodash.debounce(this.pageChange,a)},beforeRouteEnter:function(t,a,e){t.params&&"pending"===t.params.status?e(function(a){a.activeFn(t.params.status)}):e(function(t){t.getData()})},methods:{auditController:function(){this.showAuditController=!0},searIconClick:function(){this.currentPage=1,this.getData()},actionAudit:function(t,a){var e=this,i="/api/audit/"+t.row.id+"/result?status="+a;this.$axios.put(""+this.$config.apiDomain+i,{}).then(function(){t.row.status=a,"rejected"==a?(e.$Message.destroy(),e.$Message.success("已拒绝审核")):(e.$Message.destroy(),e.$Message.success("已通过审核")),e.currentPage>1&&1==e.gridList.data.length&&"all"!=e.buttonActive&&e.currentPage--,e.getData()}).catch(function(t){"ERROR_CROWD_ACTIVE_THRESHOLD"!=t.response.data.sub_code&&"ERROR_TRAIT_ACTIVE_THRESHOLD"!=t.response.data.sub_code||e.$Modal.warning({title:"无法激活 :",content:t.response.data.message})})},detailAudit:function(t){this.auditId=t,this.showDetail=!0},activeFn:function(t){this.buttonActive=t,this.currentPage=1,this.getData()},getData:function(){var t=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0;var a={q:this.searInput,page:this.currentPage,page_size:this.pageSize,status:this.buttonActive,order_by:"create_time",order:"desc"};this.$axios.get(this.$config.apiDomain+"/api/audit",{params:a}).then(function(a){var e=a.data;e.items.length||(t.loadingOrNoData="暂无数据"),e.items.forEach(function(a){a.create_time=a.create_time?t.$date(+a.create_time).format("YYYY-MM-DD HH:mm:ss"):"-",a.title=t.statusConfig[a.title]}),t.gridList.data=e.items,t.total=e.total,t.isLoading=!1}).catch(function(){t.total=0,t.gridList.data=[],t.loadingOrNoData="数据加载失败",t.isLoading=!1})},pageChange:function(t){this.currentPage=t,this.getData()}}},c={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"page-warpper"},[e("div",{staticClass:"page-title bottom-shadow page-title-tab"},[e("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":"insight"}},[e("MenuItem",{attrs:{name:"insight"}},[t._v("审核")])],1)],1),t._v(" "),e("div",{staticClass:"page-content page-content-tab container-padding24"},[e("Card",{attrs:{"dis-hover":"",padding:0}},[e("Row",{staticClass:"padding16-18"},[e("Col",{attrs:{span:"16"}},[e("ButtonGroup",[e("Button",{attrs:{type:"all"==t.buttonActive?"primary":"default"},on:{click:function(a){t.debounceActive("all")}}},[t._v("全部")]),t._v(" "),e("Button",{attrs:{type:"pending"==t.buttonActive?"primary":"default"},on:{click:function(a){t.debounceActive("pending")}}},[t._v("待审核")])],1),t._v(" "),e("Input",{staticClass:"width300 ml10",attrs:{icon:"ios-search",placeholder:"请输入名称"},on:{"on-change":t.debounceSearch},nativeOn:{keyup:function(a){return"button"in a||!t._k(a.keyCode,"enter",13,a.key,"Enter")?t.debounceSearch(a):null}},model:{value:t.searInput,callback:function(a){t.searInput=a},expression:"searInput"}}),t._v(" "),e("span",{staticClass:"total-count"},[t._v("共"),e("i",[t._v(t._s(t.total))]),t._v("条审核")])],1),t._v(" "),e("Col",{staticStyle:{"text-align":"right"},attrs:{span:"8"}},[t.isShowBtn?e("Button",{attrs:{type:"primary"},on:{click:t.auditController}},[t._v("审核控制")]):t._e()],1)],1),t._v(" "),e("Row",[e("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.isLoading,"no-data-text":t.loadingOrNoData,columns:t.gridList.columns,data:t.gridList.data}}),t._v(" "),e("Row",{staticClass:"pageRow padding16-18",attrs:{type:"flex",justify:"end"}},[e("Page",{attrs:{total:t.total,pageSize:t.pageSize,current:t.currentPage,"show-elevator":""},on:{"on-change":t.debouncePage}})],1)],1)],1),t._v(" "),e("Drawer",{attrs:{width:"600","mask-closable":!1},model:{value:t.showAuditController,callback:function(a){t.showAuditController=a},expression:"showAuditController"}},[t.showAuditController?e("auditController"):t._e()],1),t._v(" "),e("Drawer",{attrs:{width:"1000","mask-closable":!1},model:{value:t.showDetail,callback:function(a){t.showDetail=a},expression:"showDetail"}},[t.showDetail?e("auditDetail",{attrs:{auditId:t.auditId,auditType:"audit"}}):t._e()],1)],1)])},staticRenderFns:[]};var l=e("VU/8")(r,c,!1,function(t){e("DUl7")},"data-v-1b236098",null);a.default=l.exports}});