webpackJsonp([15],{"19dI":function(t,e){},"53B5":function(t,e){},"BY+v":function(t,e){},PqFO:function(t,e){},"b/uY":function(t,e){},mdvB:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("BTaQ"),o=i("CFN8"),n=i("hmnT"),s={props:{tabView:{default:"public",type:String},groupID:{default:"",type:String},groupName:{default:"",type:String},hierarchy_id:{default:[],type:Array}},data:function(){return{title:"新建特性",status_config:{},type:"trait",loading:!1,catalogList:[],typeList:[],toolTip:"请选择类型",formValidate:{traitName:"",catalogName:this.hierarchy_id,m_type:"",des:""},ruleValidate:{traitName:[{required:!0,message:"请输入名称",trigger:"blur"},{pattern:this.$config.reg_input.reg,message:this.$config.reg_input.msg,trigger:"blur"}],m_type:[{required:!0,message:"请选择特性类型",trigger:"change"}]},TimeLine_day:null,TimeLine_Type:"Number",Enum_type:"input",Enum_tagArr:[],stringType:"all",StringList:[],special_value:0}},methods:{stopFormAction:function(t){t.preventDefault()},init:function(){this.status_config=this.$config.status_config,this.getTree(),this.getTypeList()},getTree:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/catalog-tree",{params:{type:this.type,visibility:this.tabView,group_id:this.groupID||void 0,authorized:!1}}).then(function(e){var i=e.data,a=i.children||[];a.length&&("group"==t.tabView&&(a=i.children),function t(e){e.forEach(function(e){e.label=e.name,e.value=e.id,e.children&&e.children.length&&t(e.children)})}(a),t.$nextTick(function(){t.catalogList=a}))}).catch(function(){})},getTypeList:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/types").then(function(e){var i=e.data;t.typeList=i}).catch(function(){})},getStringConfig:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/types/"+this.formValidate.m_type+"/limit-types").then(function(e){var i=e.data;i.forEach(function(e){e.label=t.status_config[e.format_limit_code],e.value=e.format_limit_code}),t.StringList=i}).catch(function(){})},changeType:function(t){var e=this.$lodash.filter(this.typeList,function(e){return t===e.code});this.toolTip=e[0].description||"","String"==t&&this.getStringConfig()},cancel:function(){this.$emit("cancel",!1)},ok:function(){var t=this;this.$refs.formValidate.validate(function(e){if(e){var i={visibility:t.tabView,group_id:t.groupID||void 0,name:t.formValidate.traitName.trim(),catalog_id:t.formValidate.catalogName[t.formValidate.catalogName.length-1]||0,is_id:!1,data_type:t.formValidate.m_type,description:t.formValidate.des.trim(),format_limit_code:t.stringType&&"all"!==t.stringType?t.stringType:void 0};if("Enum"===t.formValidate.m_type){if("input"==t.Enum_type&&0==t.Enum_tagArr.length)return t.$Message.destroy(),void t.$Message.error("分类值不能为空，请输入或选择分类值");if("input"==t.Enum_type&&t.Enum_tagArr.length>20)return t.$Message.destroy(),void t.$Message.error("最多填写20个");i.optional_config={value_type_code:t.Enum_type,values:"input"==t.Enum_type?t.Enum_tagArr:[]}}if("TimeLine"===t.formValidate.m_type){if(null==t.TimeLine_day)return t.$Message.destroy(),void t.$Message.error("请设置天数");i.time_line_config={capture_date:+t.TimeLine_day,capture_unit:"day",capture_type:t.TimeLine_Type}}t.loading=!0;var a=t;t.$api.trait.createTrait(i).then(function(e){t.$Message.destroy(),t.$Message.success("已添加"),t.cancel(),a.$router.push({path:"/trait/detail",query:{name:"detail",code:e.code,tabView:a.tabView,groupID:a.groupID}}),a.loading=!1}).catch(function(){a.loading=!1})}})},changeTag:function(t){this.Enum_tagArr=t}},components:{editTitle:o.a,MultipleTag:n.a},mounted:function(){this.init()}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mask-bg trait-create"},[i("edit-title",{attrs:{loading:t.loading,title:t.title},on:{"cancel-click":t.cancel,"ok-click":t.ok}}),t._v(" "),i("div",{staticClass:"custom-dialog-content"},[i("div",{staticClass:"m20"},[i("Card",{attrs:{"dis-hover":""}},[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("基本信息")]),t._v(" "),i("Form",{ref:"formValidate",staticClass:"mt20 pl20 pr20",attrs:{"label-position":"left","label-width":80,model:t.formValidate,rules:t.ruleValidate}},[i("Form-item",{attrs:{label:"名称",prop:"traitName"}},[i("Input",{staticClass:"width500",attrs:{maxlength:20,placeholder:"请输入名称"},model:{value:t.formValidate.traitName,callback:function(e){t.$set(t.formValidate,"traitName",e)},expression:"formValidate.traitName"}})],1),t._v(" "),i("Form-item",{attrs:{label:"目录",prop:"catalogName"}},[i("Input",{staticClass:"mr10 form-cur-catalog",attrs:{value:"group"==t.tabView?t.groupName:t.status_config[t.tabView],readonly:""}}),t._v(" "),i("Cascader",{staticClass:"form-catalog",attrs:{transfer:"","change-on-select":"",data:t.catalogList},model:{value:t.formValidate.catalogName,callback:function(e){t.$set(t.formValidate,"catalogName",e)},expression:"formValidate.catalogName"}})],1),t._v(" "),i("Form-item",{attrs:{label:"类型",prop:"m_type"}},[i("Select",{staticClass:"mr10 width500",attrs:{placeholder:"请选择特性类型"},on:{"on-change":t.changeType},model:{value:t.formValidate.m_type,callback:function(e){t.$set(t.formValidate,"m_type",e)},expression:"formValidate.m_type"}},t._l(t.typeList,function(e,a){return i("Option",{key:a,attrs:{value:e.code}},[t._v("\n                                "+t._s(e.name)+"\n                            ")])})),t._v(" "),i("Tooltip",{attrs:{"max-width":"200",content:t.toolTip,placement:"right"}},[i("i",{staticClass:"fa fa-question-circle-o f16"})])],1),t._v(" "),i("Form-item",{attrs:{label:"配置"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:"TimeLine"==t.formValidate.m_type,expression:"formValidate.m_type=='TimeLine'"}]},[i("span",{staticClass:"line-height"},[t._v("记录最近")]),t._v(" "),i("InputNumber",{staticClass:"timeline-day",attrs:{min:0,step:1,placeholder:"数字填写"},model:{value:t.TimeLine_day,callback:function(e){t.TimeLine_day=e},expression:"TimeLine_day"}}),t._v(" "),i("span",{staticClass:"line-height"},[t._v("天的一个")]),t._v(" "),i("Select",{staticClass:"timeline-type",attrs:{placeholder:"请选择类型"},model:{value:t.TimeLine_Type,callback:function(e){t.TimeLine_Type=e},expression:"TimeLine_Type"}},[i("Option",{attrs:{value:"Number"}},[t._v("数字")]),t._v(" "),i("Option",{attrs:{value:"Counter"}},[t._v("计数器")])],1),t._v(" "),i("span",{staticClass:"line-height"},[t._v("类型的特性")])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"Enum"==t.formValidate.m_type,expression:"formValidate.m_type=='Enum'"}]},[i("span",{staticClass:"line-height"},[t._v("设置分类值可选范围为（最多20个）")]),t._v(" "),i("Select",{staticClass:"enum-type",attrs:{placeholder:"请选择类型"},model:{value:t.Enum_type,callback:function(e){t.Enum_type=e},expression:"Enum_type"}},[i("Option",{attrs:{value:"input"}},[t._v("自定义")]),t._v(" "),i("Option",{attrs:{value:"Zodiac"}},[t._v("十二星座")]),t._v(" "),i("Option",{attrs:{value:"ChineseZodiac"}},[t._v("十二生肖")])],1),t._v(" "),i("Form",{directives:[{name:"show",rawName:"v-show",value:"input"==t.Enum_type,expression:"Enum_type=='input'"}],staticClass:"smce-tootip-width form-multiple",nativeOn:{submit:function(e){return t.stopFormAction(e)}}},[i("multiple-tag",{attrs:{filterWords:"$","is-view":!1,"tag-arr":t.Enum_tagArr,"max-tag-num":20,isShowTip:"",canKeyDel:"",tipContent:"可输入一个或多个文本，文本中不能包含$符号","tag-width":300},on:{"change-tag":t.changeTag}})],1)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"String"==t.formValidate.m_type,expression:"formValidate.m_type=='String'"}]},[i("span",[t._v("选择数据格式为")]),t._v(" "),i("Select",{staticClass:"enum-type ",staticStyle:{width:"400px"},attrs:{placeholder:"请选择类型"},model:{value:t.stringType,callback:function(e){t.stringType=e},expression:"stringType"}},[i("Option",{attrs:{value:"all"}},[t._v("不限")]),t._v(" "),t._l(t.StringList,function(e,a){return i("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.label))])})],2)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"Enum"!=t.formValidate.m_type&&"TimeLine"!=t.formValidate.m_type&&"String"!=t.formValidate.m_type,expression:"(formValidate.m_type!='Enum')&&(formValidate.m_type!='TimeLine')&&(formValidate.m_type!='String')"}]},[i("span",{staticClass:"line-height"},[t._v("无需特殊配置")])])]),t._v(" "),i("Form-item",{attrs:{label:"描述",prop:"des"}},[i("Input",{staticClass:"width500",attrs:{maxlength:100,type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:"请输入描述"},model:{value:t.formValidate.des,callback:function(e){t.$set(t.formValidate,"des","string"==typeof e?e.trim():e)},expression:"formValidate.des"}})],1)],1)],1)],1)])],1)},staticRenderFns:[]};var l=i("VU/8")(s,r,!1,function(t){i("BY+v"),i("19dI")},"data-v-0ac8d648",null).exports,c=i("Z86P"),d={props:{columns:{default:[],type:Array},tabView:{default:"",type:String}},data:function(){return{trait_crowd:"trait",f_add:!1,buttonActive:"all",buttonList:[{value:"全部",key:"all"},{value:"激活",key:"active"},{value:"冻结",key:"freeze"}],treeLoading:!1,iniTreeList:[],childTreeList:[],curTreeID:"0",groupID:"",groupName:"",loading:!1,q:"",order:"",sortName:"",listData:[],page:{total:0,size:10,current:1},isExpandFirstLeaf:!1,is_authorized:!1,node_visibility:"",loadingOrNoData:"数据加载中...",hierarchy_id:[]}},methods:{getList:function(){var t=this;if(this.iniTreeList.length){this.loadingOrNoData="数据加载中...";var e={visibility:this.tabView,lifecycle_status:this.buttonActive,q:this.q||void 0,page:this.page.current,rows:this.page.size,sort:this.sortName||void 0,order:this.order||void 0,authorized:this.is_authorized||!1,node_visibility:this.node_visibility||void 0};"self"==this.tabView&&(e.catalog_id=0!=this.curTreeID?this.curTreeID:null),"public"==this.tabView&&(e.catalog_id=0!=this.curTreeID?this.curTreeID:null),"subordinate"==this.tabView&&(e.org_id=""==this.curTreeID?void 0:this.curTreeID),"group"==this.tabView&&(e.catalog_id=0!=this.curTreeID?this.curTreeID:null,e.group_id=this.groupID||null),this.loading=!0,this.$api.trait.getTraits(e).then(function(e){if((!e.items||0==e.items.length)&&e.page>1)return t.page.current=e.page-1,void t.getList();e.items.length||(t.loadingOrNoData="暂无数据"),t.loading=!1,t.listData=e.items,t.page.total=e.total,t.page.size=e.size,t.page.current=e.page,t.isExpandFirstLeaf&&t.expandFirstLeaf()}).catch(function(){t.page.total=0,t.listData=[],t.loadingOrNoData="数据加载失败",t.loading=!1})}},expandFirstLeaf:function(){this.$nextTick(function(){document.querySelector("#cusTree .ivu-icon-ios-arrow-forward").click()}),this.isExpandFirstLeaf=!1},getTreeList:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments[3];return this.loadingOrNoData="数据加载中...",this.$axios.get(e,{params:a}).then(function(e){var o=e.data.items;if(o.forEach(function(t){t.is_leaf||(t.loading=!1,t.children=[]),a.authorized&&(t.isNotShowIcon=!0)}),i.loading=!1,!t)return i.childTreeList=o,i.loadingOrNoData="暂无数据",i.childTreeList;if("group"===i.tabView){if(i.treeLoading=!1,i.iniTreeList=o,!o.length)return i.listData=[],i.page.current=1,i.page.total=0,void(i.loadingOrNoData="暂无数据");o.forEach(function(t){t.tid=t.group_id}),i.curTreeID=0,i.groupID=o[0].group_id,i.groupName=o[0].name,i.$emit("transGroupID",o[0].group_id)}else if("subordinate"===i.tabView){if(i.treeLoading=!1,i.iniTreeList=o,!o.length)return i.listData=[],i.page.current=1,i.page.total=0,void(i.loadingOrNoData="暂无数据");i.curTreeID=o[0].org_id}}).catch(function(){i.listData=[],i.page.current=1,i.page.total=0,i.loadingOrNoData="数据加载失败",i.treeLoading=!1,i.loading=!1,o&&(o.loading=!1)})},activeFn:function(t){this.buttonActive=t,this.q="",this.order="",this.sortName="",this.page.current=1,this.resetSort(),this.getList()},addTreeList:function(t,e,i){var a=null;if("self"===e){var o={parent_id:t.id,type:this.trait_crowd,visibility:e,rows:-1};a=this.getTreeList(!1,this.$config.apiDomain+"/catalogs",o,t)}if("public"===e){var n={parent_id:t.id,type:this.trait_crowd,visibility:e,rows:-1,authorized:!!t.authorized};a=this.getTreeList(!1,this.$config.apiDomain+"/catalogs",n,t)}if("group"===e){var s={group_id:t.group_id,parent_id:t.id?t.id:0,type:this.trait_crowd,visibility:e,rows:-1};a=this.getTreeList(!1,this.$config.apiDomain+"/catalogs",s,t).then(function(t){return t.forEach(function(t){t.tid=t.group_id+t.id}),t})}if("subordinate"===e){var r={org_id:""===t.org_id?void 0:t.org_id,rows:-1,order:"asc"};a=this.getTreeList(!1,this.$config.apiDomain+"/sys/orgs/children",r,t)}a&&a.then(function(t){t&&i(t)})},allowDrag:function(t){return!("ROLE_C_ADMIN"!=this.$config.login_info.role_id||"public"!=this.tabView&&"self"!=this.tabView||!t.id)||(!("ROLE_D_ADMIN"!=this.$config.login_info.role_id||"self"!=this.tabView&&"group"!=this.tabView||!t.id)||!("ROLE_D_OPERATOR"!=this.$config.login_info.role_id||"self"!=this.tabView&&"group"!=this.tabView||!t.id))},allowDrop:function(t){return"group"==this.tabView?!(!t.parentRootNode||!t.parentDragRootNode||t.parentRootNode.group_id!==t.parentDragRootNode.group_id):!(!t.parentRootNode||!t.parentDragRootNode||""===t.parentRootNode.id||t.parentRootNode.id!==t.parentDragRootNode.id)},drop:function(t){var e=this,i=t.after,a=t.draggingNode,o=t.parentNode,n=t.parentDragNode,s=i?"dest_id="+i.id:null,r=this.$config.apiDomain+"/catalogs/"+a.id+"/order?"+s+"&parent_id="+(o.id||0)+"&direct=ahead";this.$axios.put(r).then(function(t){var i=t.data;e.$refs.trait_tree.removeData(a[e.catalogIdKey],n&&0!=n.children.length);var s=i.items,r=o.children;e.$tools.replaceData(s,r,"id"),s.find(function(t){t.id!==a.id||t.is_leaf||(t.loading=!1)}),e.$set(o,"children",s),e.updateHierarchyId(),e.getList()})},updateHierarchyId:function(){var t=this.$refs.trait_tree.getSelectNodeHierarchyId(this.curTreeID);this.hierarchy_id=t},findList:function(t){if(t){if(this.hierarchy_id=t.hierarchy_id?t.hierarchy_id.split("-"):[],this.node_visibility=t.type,this.buttonActive="all",this.q="",this.page.current=1,this.sortName="",this.curTreeID=t.id,this.$emit("transGroupID",""),"group"===this.tabView&&t.group_id){this.groupID=t.group_id;var e=this.$lodash.find(this.iniTreeList,function(e){return e.group_id==t.group_id});this.groupName=e?e.name:"",this.$emit("transGroupID",t.group_id)}"subordinate"===this.tabView&&(this.curTreeID=t.org_id),this.is_authorized=!!t.authorized,this.$emit("isAuthorized",this.is_authorized),this.resetSort(),this.getList()}},addTree:function(t,e){var i=this,a=t.data,o=t.root,n=t.node,s=t.parent,r=a;this.$axios.post(this.$config.apiDomain+"/catalogs",{name:r.name,type:this.trait_crowd,visibility:e,parent_id:s.id||0,group_id:s.group_id||null}).then(function(t){var a=t.data;"group"==e&&(a.tid=a.group_id+a.id),i.$lodash.forEach(a,function(t,e){i.$set(r,e,t)}),i.$set(r,"isEdit",!1),i.$set(s,"loading",!1),i.$Message.destroy(),i.$Message.success("已添加")}).catch(function(){i.removeData(r,n,o)})},removeTree:function(t){var e=this,i=t.data,a=t.root,o=t.node,n=i;n.id?this.$axios.delete(this.$config.apiDomain+"/catalogs/"+n.id).then(function(){e.$Message.destroy(),e.$Message.success("已删除"),e.removeData(n,o,a)}).catch(function(){}):this.removeData(n,o,a)},removeData:function(t,e,i){var a=i.find(function(t){return t===e}).parent,o=i.find(function(t){return t.nodeKey===a}).node,n=o.children.indexOf(t);1===o.children.length&&delete o.loading,o.children.splice(n,1)},editTree:function(t,e){var i=this,a=t.data,o=t.oldData;this.$axios.put(this.$config.apiDomain+"/catalogs/"+a.id,{name:a.name,type:this.trait_crowd,visibility:e,catalog_id:a.id,group_id:a.group_id}).then(function(){i.$Message.destroy(),i.$Message.success("已修改"),i.$set(a,"isEdit",!1)}).catch(function(){i.$set(a,"name",o.name),i.$set(a,"isEdit",!1)})},search:function(){this.page.current=1,this.order="",this.sortName="",this.resetSort(),this.getList()},sortChange:function(t){this.listData.length&&(this.sortName=t.key,this.order="normal"===t.order?"":t.order,this.page.current=1,this.getList())},resetSort:function(){this.columns.push({}),this.columns.pop()},changePage:function(t){this.page.current=t,this.getList()},cancel:function(t){this.f_add=t},tabViewFn:function(t){var e=this;if(this.buttonActive="all",this.q="",this.page.current=1,this.sortName="",this.order="",this.groupID="",this.treeLoading=!1,"public"===t||"self"===t)this.isExpandFirstLeaf=!0,this.curTreeID="0",this.iniTreeList=[],this.childTreeList=[],this.$nextTick(function(){e.iniTreeList.push({name:e.$config.status_config[t],id:0,loading:!1,children:[]}),"public"===t&&e.$axios.get(e.$config.apiDomain+"/catalogs",{params:{type:"trait",visibility:"public",rows:-1,authorized:!0}}).then(function(t){t.data.items.length&&e.$set(e.iniTreeList,1,{name:"跨渠道授权",id:"",loading:!1,children:[],authorized:!0,isNotShowIcon:!0})}).catch(function(){})});else if("group"==t)this.treeLoading=!0,this.iniTreeList=[],this.childTreeList=[],this.getTreeList(!0,this.$config.apiDomain+"/user/groups",{rows:-1});else if("subordinate"==t)this.iniTreeList=[],this.childTreeList=[],this.$nextTick(function(){e.treeLoading=!0,e.getTreeList(!0,e.$config.apiDomain+"/sys/orgs/children",{rows:-1})});else if("node"===t){this.iniTreeList=[];for(var i=this.$config.login_info.role_view.buttons,a=0;a<i.length;a++)if("catalog_group_trait_in_node"===i[a].id){i[a].visible?this.iniTreeList=[{name:"私有的",id:0,type:"self"},{name:"运营组的",id:1,type:"group"}]:this.iniTreeList=[{name:"私有的",id:0,type:"self"}];break}this.$nextTick(function(){document.querySelector("#cusTree .ivu-icon-md-folder").click()}),this.isExpandFirstLeaf=!1}}},computed:{catalogIdKey:function(){return"group"==this.tabView?"tid":"subordinate"==this.tabView?"org_id":"id"}},watch:{tabView:function(t){this.tabViewFn(t)}},components:{CustomTree:c.a,AddTrait:l},created:function(){var t=this.$config.debounce_wait;this.debounceSearch=this.$lodash.debounce(this.search,t),this.debounceStatus=this.$lodash.debounce(this.activeFn,t),this.debounceSort=this.$lodash.debounce(this.sortChange,t),this.debouncePage=this.$lodash.debounce(this.changePage,t)},mounted:function(){var t=this;this.$tools.bus.$on("updateTraitList",function(){t.getList()})},beforeDestroy:function(){this.$tools.bus.$off("updateTraitList")}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"crowd-manage-box"},[i("div",{staticClass:"h100 crowd-manage-left"},[i("div",{staticClass:"crowd-manage-left-Tree"},[t.treeLoading?t._e():i("custom-tree",{directives:[{name:"role-button",rawName:"v-role-button",value:"catalog_tree_trait_"+t.tabView,expression:"`catalog_tree_trait_${tabView}`"}],ref:"trait_tree",attrs:{data:t.iniTreeList,"children-data":t.childTreeList,"max-level":5,isShowNum:!1,newNodeName:"新增目录","confirm-modal-type":"目录","confirm-modal-content":"删除后将无法恢复。",tid:t.catalogIdKey,isShowAddIcon:"subordinate"!=t.tabView,isShowDelIcon:"subordinate"!=t.tabView,isShowEditIcon:"subordinate"!=t.tabView,"load-data":function(e,i){return t.addTreeList(e,t.tabView,i)},allowDrag:t.allowDrag,allowDrop:t.allowDrop},on:{drop:t.drop,"get-table-tab-data":function(e){t.findList(e,t.tabView)},"add-tree-node":function(e){t.addTree(e,t.tabView)},"remove-tree-node":function(e){t.removeTree(e,t.tabView)},"edit-tree-node":function(e){t.editTree(e,t.tabView)}}})],1)]),t._v(" "),i("div",{staticClass:"h100 crowd-manage-right"},[i("div",{staticClass:"crowd-manage-right-list"},[i("Card",{attrs:{"dis-hover":"",padding:0}},[i("Row",{staticStyle:{margin:"16px"},attrs:{type:"flex",justify:"space-between"}},[i("Col",[i("ButtonGroup",t._l(t.buttonList,function(e,a){return i("Button",{key:a,attrs:{type:e.key==t.buttonActive?"primary":"default"},on:{click:function(i){t.debounceStatus(e.key)}}},[t._v("\n                                "+t._s(e.value)+"\n                            ")])})),t._v(" "),i("Input",{staticClass:"width300 ml10",attrs:{placeholder:"请输入特性名称/ID搜索"},on:{"on-change":t.debounceSearch},model:{value:t.q,callback:function(e){t.q=e},expression:"q"}},[i("Icon",{attrs:{slot:"suffix",type:"ios-search"},slot:"suffix"})],1),t._v(" "),i("span",{staticClass:"total-count"},[t._v("共"),i("i",[t._v(t._s(t.page.total))]),t._v("个特性")])],1),t._v(" "),t.is_authorized?t._e():i("Col",[t.iniTreeList.length?i("Button",{directives:[{name:"role-button",rawName:"v-role-button",value:"create_trait_button_"+t.tabView,expression:"'create_trait_button_' + tabView"}],attrs:{icon:"md-add",type:"primary"},on:{click:function(e){t.f_add=!0}}},[t._v("新建特性")]):t._e(),t._v(" "),i("Drawer",{attrs:{width:"1000","mask-closable":!1},model:{value:t.f_add,callback:function(e){t.f_add=e},expression:"f_add"}},[i("div",{attrs:{slot:"title"},slot:"title"}),t._v(" "),t.f_add?i("add-trait",{attrs:{tabView:t.tabView,groupID:t.groupID,hierarchy_id:t.hierarchy_id,groupName:t.groupName},on:{cancel:t.cancel}}):t._e()],1)],1)],1),t._v(" "),i("Row",[i("Col",[i("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{columns:t.columns,data:t.listData,"no-data-text":t.loadingOrNoData,loading:t.loading},on:{"on-sort-change":t.debounceSort}})],1)],1),t._v(" "),i("Row",{staticStyle:{margin:"16px"},attrs:{type:"flex",justify:"end"}},[i("Col",[i("Page",{attrs:{total:t.page.total,current:t.page.current,"show-elevator":""},on:{"on-change":t.debouncePage}})],1)],1)],1)],1)])])},staticRenderFns:[]};var p=i("VU/8")(d,u,!1,function(t){i("PqFO")},"data-v-0c1faa38",null).exports,h=i("ehEI"),f={data:function(){var t=this;return{isSaveUID:!1,loadingStatus:!1,file:null,page:{total:0,size:10,current:1},listData:[],columns:[{title:"文件名",key:"file_name",tooltip:!0},{title:"文件大小(KB)",key:"file_size"},{title:"导入人",key:"creator",tooltip:!0},{title:"创建时间",key:"create_time",width:200,render:function(e,i){return e("span",i.row.create_time?t.$date(+(""+i.row.create_time)).format("YYYY-MM-DD HH:mm:ss"):"")}},{title:"导入状态",key:"import_status",render:function(e,i){return e("span",t.$config.status_config[i.row.import_status])}},{title:"新增UID个数",key:"count_uids"},{title:"导入特性个数",key:"count_traits"},{title:"未导入文件",render:function(e,i){return i.row.support_download?e("span",{style:{cursor:"pointer",color:"#2b85e4"},on:{click:function(){t.download(i.row)}}},"下载"):e("span",{style:{color:"#808695"}},"下载")}}],loading:!1,loadingOrNoData:"数据加载中..."}},methods:{handleBeforeUpload:function(t){return t.name.substr(t.name.length-4).indexOf(".csv")<0?(this.$Message.destroy(),this.$Message.error("仅支持格式：csv"),!1):t.size/1024>1024?(this.$Message.destroy(),this.$Message.error("文件最大不超过1M"),!1):(this.file=t,!1)},upload:function(){var t=this;if(!this.file)return this.$Message.destroy(),void this.$Message.error("请先选择文件");var e=new FormData;e.append("file",this.file),this.loadingStatus=!0,this.$axios.post(this.$config.apiDomain+"/traits/import?save_new="+this.isSaveUID,e).then(function(){t.loadingStatus=!1,t.page.current=1,t.isSaveUID=!1,t.file=null,t.getList()}).catch(function(){t.loadingStatus=!1})},delete_file:function(){this.file=null},getList:function(){var t=this;this.loading=!0,this.loadingOrNoData="数据加载中...",this.$axios.get(this.$config.apiDomain+"/traits/import/list",{params:{rows:this.page.size,page:this.page.current}}).then(function(e){var i=e.data;i.items.length||(t.loadingOrNoData="暂无数据"),t.listData=i.items,t.page.current=i.page,t.page.total=i.total,t.loading=!1}).catch(function(){t.listData=[],t.page.total=0,t.loadingOrNoData="数据加载失败",t.loading=!1})},downloadTemp:function(){window.location.href=this.$config.apiDomain+"/traits/import/template"},download:function(t){window.location.href=this.$config.apiDomain+"/traits/import/download/"+t.import_id+"/non_import"},changePage:function(t){this.page.current=t,this.getList()}},components:{editTitle:o.a},mounted:function(){this.getList()}},g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mask-bg"},[i("edit-title",{attrs:{isShowBtn:!1,title:"导入特性"}}),t._v(" "),i("div",{staticClass:"custom-dialog-content"},[i("div",{staticClass:"m20"},[i("Card",{attrs:{"dis-hover":""}},[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("导入设置")]),t._v(" "),i("div",{staticClass:"pl10 pr10"},[i("Row",{staticClass:"height",attrs:{type:"flex",justify:"start",align:"middle"}},[i("Col",[i("span",{staticClass:"download_bt",on:{click:t.downloadTemp}},[t._v("下载导入文件模板")]),t._v(" "),i("Tooltip",{attrs:{placement:"right",transfer:"","max-width":"500"}},[i("i",{staticClass:"fa fa-question-circle-o f16"}),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("p",[t._v("1、支持文件扩展名：csv；")]),i("p",[t._v("2、文件最大不超过1M；")]),i("p",[t._v("3、文件内容格式：第一行是标题，从第二行开始是数据行，第一列是UID、从第二列开始是特性ID（从特性详情页面可查询到，一个文件中最多导入10个特性），列之间以英文逗号分隔；")]),i("p",[t._v("4、仅限对本渠道已激活的，无更新策略的特性导入；")]),i("p",[t._v("5、除滚动时间段和计数器类型的特性，其他类型的特性均支持导入。")]),i("p",[t._v("6、日期类型的特性仅允许3种格式：毫秒级时间戳，yyyy-mm-dd，yyyy-mm-dd hh:mm:ss")])])])],1)],1),t._v(" "),i("Row",{staticClass:"height",attrs:{type:"flex",justify:"space-between",align:"middle"}},[i("Col",[i("div",{staticClass:"upload"},[i("Upload",{attrs:{action:"",accept:".csv,text/csv,application/csv,text/comma-separated-values",format:["csv"],"max-size":1024,"before-upload":t.handleBeforeUpload}},[i("Button",{attrs:{type:"primary",ghost:"",icon:"ios-cloud-upload-outline"}},[t._v("选择文件")])],1)],1),t._v(" "),t.file?i("span",{staticClass:"ml20"},[i("Icon",{attrs:{type:"md-attach"}}),t._v("\n                                "+t._s(t.file.name)+"\n                                "),i("Icon",{staticClass:"ml20",attrs:{type:"md-close",color:"#808695",size:"14"},on:{click:t.delete_file}})],1):t._e()]),t._v(" "),t.file?i("Col",[i("Button",{attrs:{type:"primary",loading:t.loadingStatus},on:{click:t.upload}},[t._v("上传")])],1):t._e()],1),t._v(" "),i("Row",{staticClass:"height",attrs:{type:"flex",justify:"start",align:"middle"}},[i("Col",[i("Checkbox",{model:{value:t.isSaveUID,callback:function(e){t.isSaveUID=e},expression:"isSaveUID"}},[t._v("保存新增的UID及其特性数据")])],1)],1)],1)])],1),t._v(" "),i("div",{staticClass:"import_log m20"},[i("Row",[i("Col",[i("Table",{attrs:{columns:t.columns,data:t.listData,"no-data-text":t.loadingOrNoData,loading:t.loading}})],1)],1),t._v(" "),i("Row",{staticClass:"mt10",attrs:{type:"flex",justify:"end"}},[i("Col",[i("Page",{attrs:{total:t.page.total,current:t.page.current,"show-elevator":""},on:{"on-change":t.changePage}})],1)],1)],1)])],1)},staticRenderFns:[]};var m={data:function(){var t=this;this.$createElement;return{tabActive:"",tabList:[{value:"公共的",name:"public"},{value:"私有的",name:"self"},{value:"运营组的",name:"group"},{value:"同节点其他的",name:"node"},{value:"下级的",name:"subordinate"}],columns_public:[{title:"特性名称",key:"name_lifecycle_status",render:function(e,i){return e("div",{style:"display:flex;"},[e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:t.$config.status_config[i.row.lifecycle_status]},style:"width:20px;"},[e("icon",{style:"freeze"==i.row.lifecycle_status?"color:#c5c8ce":"color:#19be6b",attrs:{type:"ios-radio-button-on"}})]),e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:i.row.name,disabled:!t.showTooltip,"max-width":"250"},class:"ivu-table-cell-tooltip"},[e("span",{attrs:{id:"content"+i.index},on:{mouseenter:function(){t.handleTooltipIn(i.index)}},class:"ivu-table-cell-tooltip-content"},[i.row.name])])])}},{title:"特性ID",width:200,key:"code",ellipsis:!0,tooltip:!0},{title:"类型",width:160,key:"data_type",render:function(e,i){return e("span",t.$config.status_config[i.row.data_type])}},{title:"操作",width:120,render:function(e,i){return e(h.a,{props:{row:i.row,tabView:t.tabActive,type:"trait",pageType:"list",authorized:t.authorized}})}}],columns_self:[{title:"特性名称",key:"name_lifecycle_status",render:function(e,i){return e("div",{style:"display:flex;"},[e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:t.$config.status_config[i.row.lifecycle_status]},style:"width:20px;"},[e("icon",{style:"freeze"==i.row.lifecycle_status?"color:#c5c8ce":"color:#19be6b",attrs:{type:"ios-radio-button-on"}})]),e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:i.row.name,disabled:!t.showTooltip,"max-width":"250"},class:"ivu-table-cell-tooltip"},[e("span",{attrs:{id:"content"+i.index},on:{mouseenter:function(){t.handleTooltipIn(i.index)}},class:"ivu-table-cell-tooltip-content"},[i.row.name])])])}},{title:"特性ID",width:200,key:"code",ellipsis:!0,tooltip:!0},{title:"类型",width:160,key:"data_type",render:function(e,i){return e("span",t.$config.status_config[i.row.data_type])}},{title:"审核状态",width:110,key:"audit_status",sortable:"custom",render:function(e,i){return e("span",t.$config.status_config[i.row.audit_status])}},{title:"操作",width:120,render:function(e,i){return e(h.a,{props:{row:i.row,tabView:t.tabActive,type:"trait",pageType:"list"}})}}],columns_group:[{title:"特性名称",key:"name_lifecycle_status",render:function(e,i){return e("div",{style:"display:flex;"},[e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:t.$config.status_config[i.row.lifecycle_status]},style:"width:20px;"},[e("icon",{style:"freeze"==i.row.lifecycle_status?"color:#c5c8ce":"color:#19be6b",attrs:{type:"ios-radio-button-on"}})]),e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:i.row.name,disabled:!t.showTooltip,"max-width":"250"},class:"ivu-table-cell-tooltip"},[e("span",{attrs:{id:"content"+i.index},on:{mouseenter:function(){t.handleTooltipIn(i.index)}},class:"ivu-table-cell-tooltip-content"},[i.row.name])])])}},{title:"特性ID",width:200,key:"code",ellipsis:!0,tooltip:!0},{title:"类型",width:160,key:"data_type",render:function(e,i){return e("span",t.$config.status_config[i.row.data_type])}},{title:"审核状态",width:110,key:"audit_status",sortable:"custom",render:function(e,i){return e("span",t.$config.status_config[i.row.audit_status])}},{title:"操作",width:120,render:function(e,i){return e(h.a,{props:{row:i.row,tabView:t.tabActive,type:"trait",pageType:"list"}})}}],columns_subordinate:[{title:"特性名称",key:"name_lifecycle_status",render:function(e,i){return e("div",{style:"display:flex;"},[e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:t.$config.status_config[i.row.lifecycle_status]},style:"width:20px;"},[e("icon",{style:"freeze"==i.row.lifecycle_status?"color:#c5c8ce":"color:#19be6b",attrs:{type:"ios-radio-button-on"}})]),e(a.Tooltip,{attrs:{placement:"top",transfer:!0,content:i.row.name,disabled:!t.showTooltip,"max-width":"250"},class:"ivu-table-cell-tooltip"},[e("span",{attrs:{id:"content"+i.index},on:{mouseenter:function(){t.handleTooltipIn(i.index)}},class:"ivu-table-cell-tooltip-content"},[i.row.name])])])}},{title:"特性ID",width:200,key:"code",ellipsis:!0,tooltip:!0},{title:"类型",width:160,key:"data_type",render:function(e,i){return e("span",t.$config.status_config[i.row.data_type])}},{title:"审核状态",width:110,key:"audit_status",sortable:"custom",render:function(e,i){return e("span",t.$config.status_config[i.row.audit_status])}},{title:"操作",width:120,render:function(e,i){return e(h.a,{props:{row:i.row,tabView:t.tabActive,type:"trait",pageType:"list"}})}}],columns:[],authorized:!1,f_import:!1}},methods:{handleTooltipIn:function(t){var e=this;this.$nextTick(function(){var i=document.querySelector("#content"+t);e.showTooltip=i.scrollWidth>i.offsetWidth})},changeTab:function(t){this.$router.push({query:{tabView:t}})},traitImport:function(){this.f_import=!0},isAuthorized:function(t){this.authorized=t}},components:{TraitImport:i("VU/8")(f,g,!1,function(t){i("53B5")},"data-v-658d230e",null).exports,TabContent:p},created:function(){this.debounceTab=this.$lodash.debounce(this.changeTab,this.$config.debounce_wait)},mounted:function(){},beforeRouteEnter:function(t,e,i){var a=t.query.tabView;if(!$session.getTabview()[a])return i(function(t){_(t.$router)});"ROLE_C_OPERATOR"==$config.login_info.role_id&&"subordinate"==a?i(function(t){_(t.$router)}):i(function(t){t.tabActive=a,"self"===t.tabActive||"node"==t.tabActive?t.columns=t.columns_self:t.columns=t["columns_"+a]})},beforeRouteUpdate:function(t,e,i){var a=t.query.tabView;if(!$session.getTabview()[a])return i(function(t){_(t.$router)});"ROLE_C_OPERATOR"==$config.login_info.role_id&&"subordinate"==a?i(function(t){_(t.$router)}):(this.tabActive=a,"self"===this.tabActive||"node"===this.tabActive?this.columns=this.columns_self:this.columns=this["columns_"+a],i())},watch:{$route:function(t){"/trait"==t.path&&(sessionStorage.removeItem("traitReturn"),sessionStorage.removeItem("crowdReturn"))}}};function _(t){t.replace({path:"/trait",query:{tabView:"public"}})}var v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"h100 content-box"},[i("div",{staticClass:"w100"},[i("Menu",{staticClass:"pl24 bottom-shadow",attrs:{mode:"horizontal",theme:"light","active-name":t.tabActive},on:{"on-select":t.debounceTab}},t._l(t.tabList,function(e,a){return i("MenuItem",{directives:[{name:"role-button",rawName:"v-role-button",value:e.name+"_trait_tab",expression:"`${item.name}_trait_tab`"}],key:a,attrs:{name:""+e.name}},[t._v("\n                "+t._s(e.value)+"\n            ")])})),t._v(" "),i("div",{staticClass:"import_trait"},[i("Button",{directives:[{name:"role-button",rawName:"v-role-button",value:"import_trait_button",expression:"`import_trait_button`"}],staticClass:"mr10",attrs:{type:"primary",ghost:""},on:{click:t.traitImport}},[t._v("导入特性")]),t._v(" "),i("Drawer",{attrs:{width:"1200","mask-closable":!1},model:{value:t.f_import,callback:function(e){t.f_import=e},expression:"f_import"}},[i("div",{attrs:{slot:"title"},slot:"title"}),t._v(" "),t.f_import?i("trait-import"):t._e()],1)],1)],1),t._v(" "),i("tab-content",{staticClass:"w100 tab-content",attrs:{columns:t.columns,tabView:t.tabActive},on:{isAuthorized:t.isAuthorized}})],1)},staticRenderFns:[]};var y=i("VU/8")(m,v,!1,function(t){i("b/uY")},"data-v-42d20c74",null);e.default=y.exports}});