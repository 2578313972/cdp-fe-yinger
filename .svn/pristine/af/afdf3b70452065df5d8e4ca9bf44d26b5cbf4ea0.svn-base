webpackJsonp([24],{"/tHt":function(t,e){},WYRo:function(t,e){},Xilm:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={data:function(){return{title:"订单分析-新增分析任务",selectVal:"",saveBtnStatus:!1,ditchList:[],areaList:[],shopList:[],colorList:[],formValidate:{code:"",timeValue:[],description:"",model:[],ditch:"",area:"",shop:[],value1:"",copyditch:"",copyshop:"",copymodel:""},ruleValidate:{code:[{required:!0,message:"请输入活动名",trigger:"blur,change"}],value1:[{required:!0,message:"请选择活动时间",trigger:"blur,change"}],copymodel:[{required:!0,message:"请选择金蓝标中的其一",trigger:"blur,change"}],copyditch:[{required:!0,message:"请选择渠道或者区域",trigger:"blur,change"}],copyshop:[{required:!0,message:"请选择门店",trigger:"change"}],description:[{required:!0,message:"请输入描述",trigger:"blur,change"}]},dataBack:{}}},watch:{"formValidate.timeValue":function(t){t[0]?this.formValidate.value1="true":this.formValidate.value1=null},"formValidate.shop":function(t){t[0]?this.formValidate.copyshop="true":this.formValidate.copyshop=null},"formValidate.ditch":function(t){t?this.formValidate.copyditch="true":this.formValidate.area||(this.formValidate.copyditch="")},"formValidate.area":function(t){t?this.formValidate.copyditch="true":this.formValidate.ditch||(this.formValidate.copyditch="")}},computed:{hasChanged:function(){return this.$lodash.isEqual(this.formValidate,this.dataBack)},selectDitch:function(){var t=this,e="",a=this.formValidate.ditch,i=this.areaList.find(function(e){return e.value===t.formValidate.area}),r=this.formValidate.shop.length;return a&&(e+="[ "+a+" ]"),i&&(e+="[ "+i.label+" ]"),r&&(e+="[ "+this.formValidate.shop+" ]"),e.replace(/\[/g,"， [").replace(/\，/,"")}},components:{editTitle:a("CFN8").a},created:function(){var t=this;this.$axios.all([this.$axios.get("/cdp-web/marketplugin/orderAnalysis/queryChannelOptions?queryType=brand"),this.$axios.get("/cdp-web/marketplugin/orderAnalysis/queryChannelOptions?queryType=areaChannels")]).then(function(e){t.ditchList=e[0].data.data.map(function(t){return{label:t.name,value:t.name}}),t.ditchList.unshift({label:"选择渠道",value:"0"}),t.areaList=e[1].data.data.map(function(t){return{label:t.name,value:t.orgId}}),t.areaList.unshift({label:"选择门店",value:"0"})}),this.colorList=[{value:"金标",label:"金标"},{value:"蓝标",label:"蓝标"},{value:"蓝标转金标",label:"蓝标转金标"}]},mounted:function(){this.dataBack=this.$lodash.cloneDeep(this.formValidate)},methods:{cancel:function(){this.$emit("cancelCreatEvent",!1)},ok:function(){var t=this;this.$refs.formValidate.validate(function(e){if(e){t.saveBtnStatus=!0;var a={displayName:t.formValidate.code,brand:t.formValidate.ditch,store:t.formValidate.shop.toString(),area:"",jlb:t.formValidate.model.toString(),startTimeDay:t.$time(t.formValidate.timeValue[0]),endTimeDay:t.$time(t.formValidate.timeValue[1]),descriptions:t.formValidate.description};t.formValidate.area,t.formValidate.area&&(a.area=t.areaList.find(function(e){return e.value===t.formValidate.area}).label),t.$axios.post("/cdp-web/marketplugin/orderAnalysis/addOrderAnalysis",a).then(function(e){switch(e.data.success){case"true":t.saveBtnStatus=!1,t.$Message.destroy(),t.$Message.success(e.data.msg),t.$emit("submitCreatEvent",e)}}).catch(function(){t.saveBtnStatus=!1})}})},ditchChange:function(){"0"===this.formValidate.ditch&&(this.formValidate.ditch=void 0,this.formValidate.shop=[],this.changeStroe()),this.formValidate.ditch&&(this.formValidate.shop=[],this.changeStroe())},areaChange:function(){"0"===this.formValidate.area&&(this.formValidate.area=void 0,this.formValidate.shop=[],this.changeStroe()),this.formValidate.area&&(this.formValidate.shop=[],this.changeStroe())},shopChange:function(){this.formValidate.shop.length>0?this.formValidate.copyshop="123":this.formValidate.copyshop=null},optionChange:function(t){t.length?this.formValidate.copymodel="true":this.formValidate.copymodel=void 0,this.formValidate.model.toString()?this.selectVal="[ "+this.formValidate.model.toString()+" ]":this.selectVal=""},changeStroe:function(){var t=this,e=this.areaList.find(function(e){return e.value===t.formValidate.area}),a=void 0,i=void 0;e&&"选择门店"!==e.label&&(a=e.label),"0"!=this.formValidate.ditch&&(i=this.formValidate.ditch),this.$axios.get("/cdp-web/marketplugin/orderAnalysis/queryChannelOptions",{params:{queryType:"stroe",brand:i,area:a}}).then(function(e){t.shopList=e.data.data.map(function(t){return{label:t.storeName,value:t.storeName}})})}},activated:function(){this.formValidate={code:"",timeValue:[],description:"",model:"",ditch:"",area:"",shop:[],value1:"",copyditch:"",copyshop:""},this.selectVal="",this.$refs.formValidate.resetFields()}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"slide-create-box"},[a("edit-title",{attrs:{loading:t.saveBtnStatus,title:t.title,disabled:t.hasChanged},on:{"cancel-click":t.cancel,"ok-click":t.ok}}),t._v(" "),a("div",{staticClass:"slide-scroll-box dialog-padding20"},[a("Card",{staticClass:"pl20 pr20",attrs:{"dis-hover":""}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("基本信息")]),t._v(" "),a("Form",{ref:"formValidate",staticClass:"padding16-18",attrs:{"label-position":"left","label-width":110,model:t.formValidate,rules:t.ruleValidate}},[a("Form-item",{attrs:{label:"任务名称",prop:"code"}},[a("Input",{staticClass:"width400",attrs:{maxlength:32,placeholder:"请输入任务名称"},model:{value:t.formValidate.code,callback:function(e){t.$set(t.formValidate,"code","string"==typeof e?e.trim():e)},expression:"formValidate.code"}})],1),t._v(" "),a("Form-item",{attrs:{label:"交易起止时间",prop:"value1"}},[a("Date-picker",{staticClass:"width300",attrs:{format:"yyyy/MM/dd",type:"daterange",placement:"bottom-end",placeholder:"选择日期"},model:{value:t.formValidate.timeValue,callback:function(e){t.$set(t.formValidate,"timeValue",e)},expression:"formValidate.timeValue"}})],1),t._v(" "),a("Form-item",{attrs:{label:"渠道选择"}},[a("Form-item",{attrs:{prop:"copyditch"}},[a("i-select",{staticStyle:{width:"100px"},attrs:{placeholder:"渠道"},on:{"on-change":t.ditchChange},model:{value:t.formValidate.ditch,callback:function(e){t.$set(t.formValidate,"ditch",e)},expression:"formValidate.ditch"}},t._l(t.ditchList,function(e){return a("i-option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),t._v("\n               区域 \n            "),a("i-select",{staticStyle:{width:"80px"},attrs:{placeholder:"区域"},on:{"on-change":t.areaChange},model:{value:t.formValidate.area,callback:function(e){t.$set(t.formValidate,"area",e)},expression:"formValidate.area"}},t._l(t.areaList,function(e){return a("i-option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1),t._v("\n             选择门店 \n          "),a("Form-item",{attrs:{prop:"copyshop"}},[a("i-select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"门店"},on:{"on-change":t.shopChange},model:{value:t.formValidate.shop,callback:function(e){t.$set(t.formValidate,"shop",e)},expression:"formValidate.shop"}},t._l(t.shopList,function(e){return a("i-option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1)],1),t._v(" "),a("Form-item",{attrs:{label:"已选择渠道"}},[t._v(t._s(t.selectDitch))]),t._v(" "),a("Form-item",{attrs:{label:"金蓝标选择",prop:"copymodel"}},[a("i-select",{staticStyle:{width:"300px"},attrs:{multiple:""},on:{"on-change":t.optionChange},model:{value:t.formValidate.model,callback:function(e){t.$set(t.formValidate,"model",e)},expression:"formValidate.model"}},t._l(t.colorList,function(e){return a("i-option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1),t._v(" "),a("Form-item",{attrs:{label:"已选择金蓝标"}},[t._v(t._s(t.selectVal))]),t._v(" "),a("Form-item",{attrs:{label:"任务描述",prop:"description"}},[a("Input",{staticClass:"width400",attrs:{maxlength:100,type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:"请输入描述，100字以内"},model:{value:t.formValidate.description,callback:function(e){t.$set(t.formValidate,"description","string"==typeof e?e.trim():e)},expression:"formValidate.description"}})],1)],1)],1)],1)],1)},staticRenderFns:[]};var o={name:"Group",data:function(){return{name:"",butNum:0,current:1,pageSize:10,butData:["全部"],loading:!1,creatEvent:!1,columns:[],data:[],allData:[],allDataSize:0,calculate_status_item:["未开始","活动开始","活动结束"],maxPage:0}},components:{CreateEvent:a("VU/8")(i,r,!1,function(t){a("/tHt")},"data-v-2f1f59b3",null).exports},created:function(){var t=this;this.$createElement;this.columns=[{title:"任务名称",key:"display_name",minWidth:100},{title:"任务ID",key:"code",align:"center"},{title:"条件",align:"center",width:"280px",render:function(t,e){return t("div",{style:" max-width: 250px; overflow: hidden; textOverflow: ellipsis; whiteSpace: nowrap;"},[" ",e.row.ifItem," "])}},{title:"交易起止时间",align:"center",width:220,render:function(t,e){return t("div",[e.row.start_time_day," 至 ",e.row.end_time_day])}},{title:"状态",align:"center",render:function(e,a){return e("div",[t.calculate_status_item[a.row.calculate_status]])}},{title:"创建时间",align:"center",minWidth:100,render:function(t,e){return t("div",[new Date(e.row.create_time).toLocaleString()])}},{title:"操作",width:70,align:"center",render:function(e,a){return e("a",{on:{click:function(){t.deleteEvent(a)}}},"删除")}}],this.getData();var e=this.$config.debounce_wait;this.debounceSearch=this.$lodash.debounce(this.changeInput,e),this.debouncePage=this.$lodash.debounce(this.pageChange,e)},methods:{getData:function(){var t=this;return this.loading=!0,this.$axios.get("/cdp-web/marketplugin/orderAnalysis/queryOrderList",{params:{displayName:this.name,page:this.current,rows:this.pageSize}}).then(function(e){t.data=e.data.data,t.data.forEach(function(t){""!==t.brand&&(t.ifItem+="["+t.brand+"] "),""!==t.area&&(t.ifItem+="["+t.area+"] "),t.ifItem+="["+t.store+"]",t.ifItem=t.ifItem.slice(9)}),t.allDataSize=e.data.pageInfo.total,t.loading=!1})},changeInput:function(){this.current=1,this.getData()},addData:function(){this.creatEvent=!0},deleteEvent:function(t){var e=this;this.$Modal.confirm({title:"确认删除此活动？",content:"活动名称："+t.row.display_name,loading:!0,onOk:function(){e.$axios.delete("/cdp-web/marketplugin/orderAnalysis/deleteOrderAnalysis/"+t.row.code).then(function(t){switch(t.data.success){case"true":e.getData()}e.$Modal.remove(),e.$Message.destroy(),e.$Message.success("已删除")})},onCancel:function(){}})},pageChange:function(t){this.current=t,this.getData()},cancelCreat:function(t){this.creatEvent=t},submitCreat:function(){this.creatEvent=!1,this.getData()}},filters:{kou:function(t){return t}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-warpper"},[a("div",{staticClass:"page-title bottom-shadow page-title-tab"},[a("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":1}},[a("MenuItem",{key:0,attrs:{name:1}},[t._v("订单分析管理")])],1)],1),t._v(" "),a("div",{staticClass:"page-content page-content-tab padding16-18"},[a("Card",{attrs:{"dis-hover":""}},[a("Row",{staticClass:"code-row-bg padding16-18",attrs:{type:"flex",justify:"space-between"}},[a("i-col",[a("Button-group",t._l(t.butData,function(e,i){return a("i-button",{key:e,attrs:{type:t.butNum===i?"primary":null}},[t._v(t._s(e))])})),t._v(" "),a("i-input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"活动名称搜索"},on:{input:t.debounceSearch},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),a("i-col",[a("i-button",{attrs:{size:"large",icon:"md-add",type:"primary"},on:{click:t.addData}},[t._v("任务")])],1)],1),t._v(" "),a("Table",{ref:"table",staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.loading,"no-data-text":"暂无数据",columns:t.columns,data:t.data}}),t._v(" "),a("Page",{staticClass:"mt16 padding16-18 ivu-row-flex ivu-row-flex-end",attrs:{current:t.current,"page-size":t.pageSize,total:t.allDataSize,"show-elevator":""},on:{"on-change":t.debouncePage}})],1)],1),t._v(" "),a("Drawer",{attrs:{width:"800","mask-closable":!1},model:{value:t.creatEvent,callback:function(e){t.creatEvent=e},expression:"creatEvent"}},[t.creatEvent?a("create-event",{on:{cancelCreatEvent:t.cancelCreat,submitCreatEvent:t.submitCreat}}):t._e()],1)],1)},staticRenderFns:[]};var n=a("VU/8")(o,l,!1,function(t){a("WYRo")},"data-v-678d36fc",null);e.default=n.exports}});