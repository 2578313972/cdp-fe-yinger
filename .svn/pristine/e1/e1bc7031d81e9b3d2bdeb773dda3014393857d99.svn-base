webpackJsonp([27],{fsTA:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={data:function(){return{title:"新建活动",saveBtnStatus:!1,formValidate:{code:"",timeValue:[],description:"",value1:""},ruleValidate:{code:[{required:!0,message:"请输入活动名",trigger:"blur,change"}],value1:[{required:!0,message:"请选择活动时间",trigger:"blur,change"}],description:[{required:!0,message:"请输入活动描述",trigger:"blur,change"}]},dataBack:{}}},watch:{"formValidate.timeValue":function(t){t[0]?this.formValidate.value1="true":this.formValidate.value1=null}},computed:{hasChanged:function(){return this.$lodash.isEqual(this.formValidate,this.dataBack)}},components:{editTitle:a("CFN8").a},mounted:function(){this.dataBack=this.$lodash.cloneDeep(this.formValidate)},methods:{cancel:function(){this.$emit("cancelCreatEvent",!1)},ok:function(){var t=this;this.$refs.formValidate.validate(function(e){if(e){t.saveBtnStatus=!0;var a={display_name:t.formValidate.code,starttime_day:t.formValidate.timeValue[0],endtime_day:t.formValidate.timeValue[1],descriptions:t.formValidate.description};a.starttime_day=t.$time(a.starttime_day),a.endtime_day=t.$time(a.endtime_day),t.$axios.post("/cdp-web/marketplugin/calendarManagement/addActivity",a,{headers:{"Content-Type":"application/json"}}).then(function(e){t.saveBtnStatus=!1,t.$Message.destroy(),t.$Message.success("已添加"),t.$emit("submitCreatEvent",e)}).catch(function(){t.saveBtnStatus=!1})}})}},destroyed:function(){}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"slide-create-box"},[a("edit-title",{attrs:{loading:t.saveBtnStatus,title:t.title,disabled:t.hasChanged},on:{"cancel-click":t.cancel,"ok-click":t.ok}}),t._v(" "),a("div",{staticClass:"slide-scroll-box dialog-padding20"},[a("Card",{staticClass:"pl20 pr20",attrs:{"dis-hover":""}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("基本信息")]),t._v(" "),a("Form",{ref:"formValidate",staticClass:"padding16-18",attrs:{"label-position":"left","label-width":110,model:t.formValidate,rules:t.ruleValidate}},[a("Form-item",{attrs:{label:"活动名称",prop:"code"}},[a("Input",{staticClass:"width400",attrs:{maxlength:32,placeholder:"请输入活动名称"},model:{value:t.formValidate.code,callback:function(e){t.$set(t.formValidate,"code","string"==typeof e?e.trim():e)},expression:"formValidate.code"}})],1),t._v(" "),a("Form-item",{attrs:{label:"活动时间",prop:"value1"}},[a("Date-picker",{staticClass:"width300",attrs:{format:"yyyy/MM/dd",type:"daterange",placement:"bottom-end",placeholder:"选择日期"},model:{value:t.formValidate.timeValue,callback:function(e){t.$set(t.formValidate,"timeValue",e)},expression:"formValidate.timeValue"}})],1),t._v(" "),a("Form-item",{attrs:{label:"活动描述",prop:"description"}},[a("Input",{staticClass:"width400",attrs:{maxlength:100,type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:"请输入活动描述，长度为100字以内"},model:{value:t.formValidate.description,callback:function(e){t.$set(t.formValidate,"description","string"==typeof e?e.trim():e)},expression:"formValidate.description"}})],1)],1)],1)],1)],1)},staticRenderFns:[]};var s={name:"Group",data:function(){return{name:"",butNum:0,current:1,pageSize:10,butData:["全部","进行中","未开始","结束"],loading:!1,creatEvent:!1,columns:[],data:[],allData:[],allDataSize:0,calculate_status_item:["进行中","未开始","完成"],statusName:[],maxPage:0}},components:{CreateEvent:a("VU/8")(i,n,!1,function(t){a("iHIK")},"data-v-0f4e412c",null).exports},created:function(){var t=this;this.$createElement;this.statusName=["processing","nostarted","completed"],this.columns=[{title:"活动名称",key:"display_name",render:function(t,e){return t("div",{style:"display:flex;"},[t("icon",{style:"color:#19be6b;margin:auto 0;",attrs:{type:"ios-radio-button-on"}}),t("span",[" ",e.row.display_name," "])])}},{title:"活动ID",key:"code",align:"center"},{title:"状态",align:"center",render:function(e,a){return e("div",[t.calculate_status_item[a.row.calculate_status]])}},{title:"活动时间",align:"center",render:function(t,e){return t("div",[e.row.starttime_day," 至 ",e.row.endtime_day])}},{title:"操作",key:"action",width:150,align:"center",render:function(e,a){return e("a",{on:{click:function(){t.deleteEvent(a)}}},"删除")}}],this.getData();var e=this.$config.debounce_wait;this.debounceSearch=this.$lodash.debounce(this.changeInput,e),this.debouncePage=this.$lodash.debounce(this.pageChange,e)},methods:{getData:function(){var t=this;return this.loading=!0,this.$axios.get("/cdp-web/marketplugin/calendarManagement/queryList",{params:{calc_status:this.statusName[this.butNum-1],q:this.name,page:this.current,rows:this.pageSize}}).then(function(e){t.data=e.data.data,t.maxPage=Math.max(t.maxPage,e.data.pageInfo.total),t.allDataSize=e.data.pageInfo.total,t.loading=!1})},changeInput:function(){this.current=1,this.getData()},butStatus:function(t){this.butNum!==t&&(this.butNum=t,this.getData())},addData:function(){this.creatEvent=!0},deleteEvent:function(t){var e=this;this.$Modal.confirm({title:"确认删除此活动？",content:"活动名称："+t.row.display_name,loading:!0,onOk:function(){e.$axios.delete("/cdp-web/marketplugin/calendarManagement/delete/"+t.row.code).then(function(t){switch(t.data.success){case"true":e.getData()}e.$Modal.remove(),e.$Message.destroy(),e.$Message.success("已删除")})},onCancel:function(){}})},pageChange:function(t){this.current=t,this.getData()},cancelCreat:function(t){this.creatEvent=t},submitCreat:function(){this.getData(),this.creatEvent=!1},downloadExcel:function(){this.$refs.table.exportCsv({filename:"原始数据"})}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-warpper"},[a("div",{staticClass:"page-title bottom-shadow page-title-tab"},[a("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":1}},[a("MenuItem",{key:0,attrs:{name:1}},[t._v("生活日历看板")])],1)],1),t._v(" "),a("div",{staticClass:"page-content page-content-tab padding16-18"},[a("Card",{attrs:{"dis-hover":""}},[a("Row",{staticClass:"code-row-bg padding16-18",attrs:{type:"flex",justify:"space-between"}},[a("i-col",[a("Button-group",t._l(t.butData,function(e,i){return a("i-button",{key:e,attrs:{type:t.butNum===i?"primary":null},on:{click:function(e){t.butStatus(i)}}},[t._v(t._s(e))])})),t._v(" "),a("i-input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"活动名称搜索"},on:{input:t.debounceSearch},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),a("span",{staticClass:"total-count"},[t._v("\n            共\n            "),a("i",[t._v(t._s(t.allDataSize))]),t._v("个活动\n          ")])],1),t._v(" "),a("i-col",[a("span",{staticClass:"top-font",on:{click:t.downloadExcel}},[t._v("下载模板")]),t._v(" "),a("i-button",{attrs:{size:"large"}},[t._v("导入")]),t._v(" "),a("i-button",{attrs:{size:"large",icon:"md-add",type:"primary"},on:{click:t.addData}},[t._v("添加活动")])],1)],1),t._v(" "),a("Table",{ref:"table",staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.loading,"no-data-text":"暂无数据",columns:t.columns,data:t.data}}),t._v(" "),a("Page",{staticClass:"mt16 padding16-18 ivu-row-flex ivu-row-flex-end",attrs:{current:t.current,"page-size":t.pageSize,total:t.allDataSize,"show-elevator":""},on:{"on-change":t.debouncePage}})],1)],1),t._v(" "),a("Drawer",{attrs:{width:"800","mask-closable":!1},model:{value:t.creatEvent,callback:function(e){t.creatEvent=e},expression:"creatEvent"}},[t.creatEvent?a("create-event",{on:{cancelCreatEvent:t.cancelCreat,submitCreatEvent:t.submitCreat}}):t._e()],1)],1)},staticRenderFns:[]};var r=a("VU/8")(s,o,!1,function(t){a("mz/v")},"data-v-528b2223",null);e.default=r.exports},iHIK:function(t,e){},"mz/v":function(t,e){}});