<template>
  <div class="page-warpper">
    <div class="page-title bottom-shadow page-title-tab">
      <Menu class="pl24" mode="horizontal" theme="light" :active-name="1">
        <MenuItem :key="0" :name="1">营销分析整体概览</MenuItem>
      </Menu>
    </div>
    <div class="page-content page-content-tab">
      <!-- 顶部下载图标 -->
      <Row style="padding:10px 0;background:white;">
        <i-col span="6" offset="18" style="text-align:center;">
            <i style="font-weight:700;font-size:25px;margin-right:20px;cursor: pointer;" class="el-icon-download"></i>
            <i style="font-weight:700;font-size:25px;cursor: pointer;" class="el-icon-question"></i>
        </i-col>
      </Row>
        <p class="rbg">订单分析-整体概览</p>
        <div class="content-text flex borbox padding16-18">
          <div class="content-text-left" >
              <h3 class="borbox title">总销售额</h3>
              <div class="user-info">
                <div class="header-img" >
                  <!--<Icon type="person-stalker" style="font-size:30px;color:#bbbdc6;"></Icon>-->
                  <img style="width:90px;height:90px;" src="@/assets/images/yinger.png" title="影儿时尚集团">
                </div>
                <h2 style="font-size:24px; margin-top:6px;color:#1890ff;padding:0 6px;"> {{allData.sales_amount | toFixed | allMoney}} </h2>
              </div>
          </div>
          <div class="content-text-right">
              <h3 class="borbox title">消费分析</h3>
              <div class="flex conten">
                <div class="conten-child  two">
                  <div>
                    <p>平均客单价</p>
                    <p>{{allData.avg_transaction_value | toFixed}}</p>
                  </div>
                  <div>
                    <p>平均客单件</p>
                    <p>{{allData.avg_transaction_unit | toFixed}}</p>
                  </div>
                </div>
                <div class="conten-child  two">
                  <div>
                    <p>平均件单价</p>
                    <p>{{allData.avg_unit_value | toFixed}}</p>
                  </div>
                  <div>
                    <p>联单率</p>
                    <p>{{allData.joint_purchase_rate*100 | toFixed}}%</p>
                  </div>
                </div>
                <div class="conten-child  two">
                  <div>
                    <p>新会员人数</p>
                    <p>{{allData.new_vip_count}}</p>
                  </div>
                  <div>
                    <p>新会员占比</p>
                    <p>{{allData.new_vip_rate*100 | toFixed}}%</p>
                  </div>
                </div>
                <div class="conten-child two one">
                  <div>
                    <p>新会员转化率</p>
                  </div>
                  <div>
                    <p>{{allData.new_vip_case_rate*100 | toFixed}}%</p>
                  </div>
                </div>
                <div class="conten-child  two">
                  <div>
                    <p>老会员人数</p>
                    <p>{{allData.old_vip_count}}</p>
                  </div>
                  <div>
                    <p>老会员占比</p>
                    <p>{{allData.old_vip_rate*100 | toFixed}}%</p>
                  </div>
                </div>
                <div class="conten-child two one">
                  <div>
                    <p>平均折扣率</p>
                  </div>
                  <div>
                    <p>{{allData.avg_discount_rate*100 | toFixed}}%</p>
                  </div>
                </div>
              </div>
          </div>
        </div>

        <p class="rbg">订单分析-TOP排名</p>
        <div ref="content" class="padding16-18">
          <Table :width="conWidth" border :columns="columns" :data="tableData"></Table>
          <h2 style="text-indent:15px;margin-top:15px;">退货率</h2>

          <div class="flex echarts">
            <div id="main1"></div>
            <div id="main2"></div>
          </div>
          <div class="hr"></div>
          <div>
            <div id="main3"></div>
            <div class="hr"></div>
            <div id="main4"></div>
            <div class="hr"></div>
            <div id="main5"></div>
            <div class="hr"></div>
            <div id="main6"></div>
          </div>
          <div class="hr"></div>
          <div>
            <div id="main7"></div>
            <div class="hr"></div>
            <div id="main8"></div>
            <div class="hr"></div>
            <div id="main9"></div>
          </div>
        </div>


    </div>
  </div>
</template>
<script>
    export default {
        name: 'Group',
        data() {
            return {
                columns: [],
                tableData: [], // 表格数据
                allData: {}, // 所有数据内容
                conWidth: 0 // 内容宽度
            };
        },
        created() {
            this.columns = [
                {
                    title: '指标名称',
                    key: 'keyName',
                    align: 'center',
                    width: 180
                }
            ];

            for (let i = 1; i <= 10; i++) {
                this.columns.push({
                    title: `Top${i}`, key: `top${i}`, minWidth: 200, align: 'center'
                });
            }
        },
        mounted() {
            this.conWidth = this.$refs.content.clientWidth - 36;
            const setWidth = Math.max(this.conWidth / 2 - 200, 450);
            // 仪表盘
            const domChart1 = document.getElementById('main1');
            const domChart2 = document.getElementById('main2');
            // 树状图 （横）
            const domChart3 = document.getElementById('main3');
            const domChart4 = document.getElementById('main4');
            const domChart5 = document.getElementById('main5');
            const domChart6 = document.getElementById('main6');
            // 树状图 （竖）
            const domChart7 = document.getElementById('main7');
            const domChart8 = document.getElementById('main8');
            const domChart9 = document.getElementById('main9');

            domChart1.style.width = `${setWidth}px`;
            domChart1.style.height = `${setWidth}px`;

            domChart2.style.width = `${setWidth}px`;
            domChart2.style.height = `${setWidth}px`;

            domChart3.style.width = `${this.conWidth}px`;
            domChart3.style.height = '200px';

            domChart4.style.width = `${this.conWidth}px`;
            domChart4.style.height = '200px';

            domChart5.style.width = `${this.conWidth}px`;
            domChart5.style.height = '350px';

            domChart6.style.width = `${this.conWidth}px`;
            domChart6.style.height = '400px';

            domChart7.style.width = `${this.conWidth}px`;
            domChart7.style.height = '400px';

            domChart8.style.width = `${this.conWidth}px`;
            domChart8.style.height = '400px';

            domChart9.style.width = `${this.conWidth}px`;
            domChart9.style.height = '400px';

            const myChart1 = this.echarts.init(document.getElementById('main1'));
            const myChart2 = this.echarts.init(document.getElementById('main2'));

            const myChart3 = this.echarts.init(document.getElementById('main3'));
            const myChart4 = this.echarts.init(document.getElementById('main4'));
            const myChart5 = this.echarts.init(document.getElementById('main5'));
            const myChart6 = this.echarts.init(document.getElementById('main6'));

            const myChart7 = this.echarts.init(document.getElementById('main7'));
            const myChart8 = this.echarts.init(document.getElementById('main8'));
            const myChart9 = this.echarts.init(document.getElementById('main9'));

            this.$axios.get('/cdp-web/marketplugin/orderAnalysis/overview').then((res) => {
                console.log(res);
                this.allData = res.data.data[0];

                // 表格数据
                this.tableData = [
                    { keyName: '销量款色TOP10排名' },
                    { keyName: '销售额款色TOP10排名' },
                    { keyName: '商品偏好-品类分布' }
                ];
                for (let i = 1; i <= 10; i++) {
                    this.tableData[0][`top${i}`] = Object.keys(this.allData.top10_by_unit[i - 1])[0];
                    this.tableData[1][`top${i}`] = Object.keys(this.allData.top10_by_value[i - 1])[0];
                    this.tableData[2][`top${i}`] = Object.keys(this.allData.category_distribution[i - 1])[0];
                }

                const option1 = {
                    tooltip: {
                        formatter: '{a} <br/>{b} : {c}%'
                    },
                    series: [
                        {
                            name: '订单销量',
                            type: 'gauge',
                            title: { color: '#333' },
                            detail: {
                                fontSize: 20,
                                offsetCenter: [0, '50%'],
                                formatter: '{value}%\n \n \n 订单销量退货率'
                            },
                            data: [{ value: this.allData.total_count_return_rate, name: '退货率' }]
                        }
                    ]
                };
                const option2 = {
                    tooltip: {
                        formatter: '{a} <br/>{b} : {c}%'
                    },
                    series: [
                        {
                            name: '订单销售额',
                            type: 'gauge',
                            title: { color: '#333' },
                            detail: {
                                fontSize: 20,
                                offsetCenter: [0, '50%'],
                                formatter: '{value}%\n \n \n 订单销售额退货率'
                            },
                            data: [{ value: this.allData.total_sales_return_rate, name: '退货率' }]
                        }
                    ]
                };

                const option3 = {
                    color: ['#3398DB'],
                    title: {
                        text: '会员订单占比'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}<span>%</span>`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value} %'
                        },
                        show: true
                    },
                    yAxis: {
                        type: 'category',
                        data: ['会员订单', '非会员订单']
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: 30,
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: [this.allData.vip_order_scale * 100, 100 - this.allData.vip_order_scale * 100]
                        }
                    ]
                };
                const option4 = {
                    color: ['#3398DB'],
                    title: {
                        text: '会员金额占比'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}<span>%</span>`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value} %'
                        },
                        show: true
                    },
                    yAxis: {
                        type: 'category',
                        data: ['会员订单', '非会员订单']
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: 30,
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: [this.allData.vip_sales_scale * 100, 100 - this.allData.vip_sales_scale * 100]
                        }
                    ]
                };
                const option5 = {
                    color: ['#3398DB'],
                    title: {
                        text: '联单件数占比分析'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}<span>%</span>`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'value',
                        boundaryGap: true,
                        axisLabel: {
                            show: true,
                            formatter: '{value} %'
                        },
                        show: true
                    },
                    yAxis: {
                        type: 'category',
                        data: ['联单件数5件以上占比', '联单件数3件以上占比', '联单件数2件占比', '联单件数1件以上占比']
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: 30,
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: [this.allData.joint5_purchase_scale, this.allData.joint3_purchase_scale, this.allData.joint2_purchase_scale, this.allData.joint1_purchase_scale]
                        }
                    ]
                };
                const option6 = {
                    color: ['#3398DB'],
                    title: {
                        text: '商业偏好-季节分布'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value} '
                        },
                        show: true
                    },
                    yAxis: {
                        type: 'category',
                        data: this.allData.season_distribution.map(item => Object.keys(item)[0])
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: 30,
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: this.allData.season_distribution.map((item, index) => item[this.allData.season_distribution.map(item => Object.keys(item)[0])[index]])
                        }
                    ]
                };

                const option7 = {
                    color: ['#3398DB'],
                    title: {
                        text: '商品偏好-价格带分布'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'category',
                        data: this.allData.price_range_distribution.map(item => Object.keys(item)[0])
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}'
                        },
                        show: true
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: '60%',
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: this.allData.price_range_distribution.map((item, index) => item[this.allData.price_range_distribution.map(item => Object.keys(item)[0])[index]]),
                            label: {
                                show: true,
                                formatter: item => `${item.value} ${item.name}`
                            }
                        }
                    ]
                };

                const option8 = {
                    color: ['#3398DB'],
                    title: {
                        text: '商品偏好-色系分布'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'category',
                        data: this.allData.color_distribution.map(item => Object.keys(item)[0])
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}'
                        },
                        show: true
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: '60%',
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: this.allData.color_distribution.map((item, index) => item[this.allData.color_distribution.map(item => Object.keys(item)[0])[index]]),
                            label: {
                                show: true,
                                formatter: item => `${item.value} ${item.name}`
                            }
                        }
                    ]
                };

                const option9 = {
                    color: ['#3398DB'],
                    title: {
                        text: '商品偏好-面料分布'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: item => `${item[0].axisValue} <br /> ${item[0].marker}${item[0].seriesName}:${item[0].value}`
                    },
                    legend: {
                        textStyle: {
                            fontSize: 15
                        },
                        data: [{ name: '整体概览' }]
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                        backgroundColor: 'red'
                    },
                    xAxis: {
                        type: 'category',
                        data: this.allData.fabric_distribution.map(item => Object.keys(item)[0])
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value} '
                        },
                        show: true
                    },
                    series: [
                        {
                            name: '整体概览',
                            barWidth: '60%',
                            barGap: '10%',
                            legendHoverLink: true,
                            type: 'bar',
                            data: this.allData.fabric_distribution.map((item, index) => item[this.allData.fabric_distribution.map(item => Object.keys(item)[0])[index]]),
                            label: {
                                show: true,
                                formatter: item => `${item.value} ${item.name}`
                            }
                        }
                    ]
                };


                myChart1.setOption(option1);
                myChart2.setOption(option2);

                myChart3.setOption(option3);
                myChart4.setOption(option4);
                myChart5.setOption(option5);
                myChart6.setOption(option6);

                myChart7.setOption(option7);
                myChart8.setOption(option8);
                myChart9.setOption(option9);
            });
        },
        methods: {},
        filters: {
            /** 每3位数字  加上 逗号 */
            allMoney: (val) => {
                if (!val) return '······';
                let num = (val.split('.')[0] || 0).toString(); let
                    result = '';
                while (num.length > 3) {
                    result = `,${num.slice(-3)}${result}`;
                    num = num.slice(0, num.length - 3);
                }
                if (num) { result = num + result; }
                return `${result}.${val.split('.')[1]}`;
            },
            toFixed: val => !!val && val.toFixed(2)
        }
    };
</script>
<style lang="less" scoped>
    .content-text {
      width: 100%;
      overflow: hidden;
      // margin-top: 15px;

      > div{
        border-radius: 4px;
        background: white;
      }
      .content-text-left{
        min-width:200px;
        margin-right: 10px;
        text-align: center;
      }
      .content-text-right{
        flex: 1;
        .conten{
          height: calc( 100% - 45px);
          .conten-child{
            flex: 1;
            height: 100%;
            border-right: 1px solid #EEF0F3;
            &:last-child{border-right: 0px;}
          }
          .two{

            >div{
              height: 50%;
              box-sizing: border-box;
              &:first-child{
                box-sizing: border-box;
                padding-top: 5px;
                height: calc( 50% - 5px );
                border-bottom: 1px solid #EEF0F3;
              }
              &:last-child{
                box-sizing: border-box;
                padding-top: 10px;
              }
              p{
                &:first-child{
                  text-indent: 10px;
                  color: #666;
                }
                &:last-child{
                  padding-top: 10px;
                  text-indent: 15px;
                  color: #4453E8;
                }
              }
            }
          }
          .one>div{
            font-size: 17px;
            &:first-child{
              border-bottom: 1px solid transparent;
              p{
                color: #666;

              }
            }
          }
        }
      }
      .title{
        line-height: 35px;
        text-align: left;
        text-indent: 10px;
        margin-bottom: 10px;
        border-bottom: 1px solid #EEF0F3;
      }
    }
    .rbg{
      font-size: 16px;
      text-indent: 30px;
      line-height: 40px;
      background-color: #D7D7D7;
    }
    .echarts{
      justify-content: space-around;
    }
    .hr{
        width: 100%;
        height: 0px;
        border: 1px solid transparent;
        border-top-color:black;
        margin: 30px 0;
    }
</style>
