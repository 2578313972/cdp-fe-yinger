webpackJsonp([12],{"1jHF":function(t,e){},"8FFS":function(t,e){},Z3po:function(t,e){},fSzI:function(t,e){},hLL3:function(t,e){},oSpf:function(t,e,i){"use strict";var a=i("txAQ"),s={data:function(){var t=this;this.$createElement;return{isMember:"/member"==this.$route.path,searInput:"",currentPage:1,pageSize:10,total:0,visible:!1,searMember:"",selectTransferData:[],loadingOrNoData:"数据加载中...",isLoading:!1,roleTypes:[{value:1,label:"节点管理员"},{value:0,label:"节点运营人员"}],roleList:{ROLE_C_ADMIN:"渠道管理员",ROLE_D_ADMIN:"节点管理员",ROLE_D_OPERATOR:"节点运营人员"},selectData:[],searLoading:!1,gridList:{columns:[{title:"姓名",key:"name"},{title:"邮箱",key:"email"},{renderHeader:function(e){return e("div",{style:{position:"relative",linehHeight:"40px"}},[e("span",{style:{paddingRight:"3px"}},"成员角色"),e("Tooltip",{style:{display:t.isMember?"none":""},props:{"max-width":"300",content:"被设为节点管理员的账号将具有管理本节点运营组，负责本节点资源初审的权限",placement:"top",transfer:!0}},[e("i",{style:{"font-size":"14px"},attrs:{class:"fa fa-question-circle-o"}})])])},key:"is_admin",render:function(e,i){return e("div",[e("icon",{attrs:{size:"20",color:i.row.is_admin?"#06B75E":"#AFB2BA",type:"md-contact"}}),t.isMember?e("span",{style:"padding-left:5px;"},[t.roleList[i.row.role_id]||"-"]):e("i-select",{attrs:{transfer:!0,size:"small",value:i.row.is_admin},on:{"on-change":function(e){t.changeIsLeader(i,e)}},class:"role-select",style:"width:105px;"},[t.roleTypes.map(function(t){return e("i-option",{attrs:{value:t.value}},[t.label])})])])}},{title:"操作",key:"action",width:150,render:function(e,i){return e("div",[t.isMember?e(a.a,{attrs:{type:"self",orginInfo:i.row,selectData:t.selectTransferData}}):e("a",{style:"margin: 0 10px 0 0",on:{click:function(){return t.confirmDelete(i.row)}}},["删除"])])}}],data:[]}}},props:{orgInfo:{type:Object,default:function(){return{}}},isOrg:Boolean},created:function(){var t=this.$config.throttle_wait;this.debounceSearch=this.$lodash.debounce(this.remoteMethod,t),this.debouncePage=this.$lodash.debounce(this.pageChange,t),this.debounceSearchList=this.$lodash.debounce(this.searIconClick,this.$config.debounce_wait),this.getTransferData()},methods:{handleOpen:function(){this.visible=!this.visible},handleClose:function(t){this.isClickSelf(t.target)||(this.visible=!1,this.resetAddInput())},getTransferData:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/sys/resource/users?size=-1").then(function(e){var i=e.data;t.selectTransferData=i.items.map(function(t){return{name:t.name,label:t.email,value:t.user_id}}),t.isMember&&t.getData()}).catch(function(){t.selectTransferData=[]})},searIconClick:function(){this.currentPage=1,this.getData()},changeIsLeader:function(t,e){var i=this;t.row.is_admin=e;var a="/sys/orgs/auth/"+t.row.user_id+"?is_admin="+!!e;this.$axios.put(""+this.$config.apiDomain+a).then(function(){i.$Message.success("已修改")}).catch(function(){t.row.is_admin=1==e?0:1})},addSpecia:function(t){var e=this;if(t){var i=t.value,a="/sys/operators/channel-operators/"+i;this.orgInfo.org_id&&(a="/sys/orgs/"+this.orgInfo.org_id+"/auth"),this.$axios.post(""+this.$config.apiDomain+a,{user_id:i,role_id:"ROLE_D_OPERATOR"}).then(function(){e.$Message.success("已添加"),e.currentPage=1,e.getData(),e.resetAddInput(),e.visible=!1}).catch(function(){e.resetAddInput(),e.visible=!1})}},resetAddInput:function(){this.searInput="",this.searMember="",this.selectData=[]},confirmDelete:function(t){var e=this;this.$Modal.confirm({title:"确认取消授权此帐号？",content:"姓名："+t.name+"<br/><br/>取消授权后，此账号将无法登陆当前渠道。",onOk:function(){e.deleteAccount(t.user_id)}})},deleteAccount:function(t){var e=this,i="/sys/orgs/auth/"+t;this.$axios.delete(""+this.$config.apiDomain+i,{}).then(function(){e.$Message.success("取消授权成功"),e.currentPage>1&&1==e.gridList.data.length&&e.currentPage--,e.getData()})},getData:function(){var t=this;this.loadingOrNoData="数据加载中...",this.isLoading=!0;var e="/sys/orgs/"+this.orgInfo.org_id+"/org-members";this.isMember&&(e="/sys/resource/users");var i={q:this.searInput||void 0,page:this.currentPage,rows:this.pageSize};this.$axios.get(""+this.$config.apiDomain+e,{params:i}).then(function(e){var i=e.data;i.items.length||(t.loadingOrNoData="暂无数据"),t.gridList.data=i.items.map(function(t){return{name:t.name,email:t.email,id:t.user_id,user_id:t.user_id,role_id:t.role_id,is_admin:+("ROLE_D_ADMIN"===t.role_id||"ROLE_C_ADMIN"===t.role_id||"ROLE_D_ADMIN"===t.role_id)}}),t.total=i.total,t.isLoading=!1}).catch(function(){t.total=0,t.gridList.data=[],t.loadingOrNoData="数据加载失败",t.isLoading=!1})},remoteMethod:function(){var t=this;if(""!==this.searMember){this.searLoading=!0;var e={q:this.searMember,size:-1};this.$axios.get(this.$config.apiDomain+"/sys/orgs/users",{params:e}).then(function(e){var i=e.data;t.searLoading=!1;var a=i.items.map(function(t){return{name:t.name,label:t.email,value:t.user_id}});t.selectData=a})}else this.selectData=[]},pageChange:function(t){this.currentPage=t,this.getData()},isClickSelf:function(t){var e=t,i=!1,a=1e3;if(null!=e){do{if(/add\-member\-box/.test(e.className)){i=!0;break}a--,e=e.parentNode}while(e&&e.nodeName&&"HTML"!=e.nodeName.toUpperCase()&&a>0);return i}}},watch:{orgInfo:function(){this.resetAddInput(),this.currentPage=1,this.getData()}}},o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{m24:t.isOrg,"page-warpper":!t.isOrg}},[t.isOrg?t._e():i("div",{staticClass:"page-title bottom-shadow page-title-tab"},[i("Menu",{staticClass:"pl24",attrs:{mode:"horizontal",theme:"light","active-name":"insight"}},[i("MenuItem",{attrs:{name:"insight"}},[t._v("成员管理")])],1)],1),t._v(" "),i("div",{staticClass:"page-content page-content-tab",class:{"container-padding24":!t.isOrg}},[i("Card",{attrs:{"dis-hover":"",padding:0}},[i("Row",{staticClass:"padding16-18"},[i("Col",{staticClass:"search-wrapper"},[t.isMember?i("Input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"请输入姓名/邮箱"},on:{"on-change":t.debounceSearchList},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.debounceSearchList(e):null}},model:{value:t.searInput,callback:function(e){t.searInput=e},expression:"searInput"}}):i("Dropdown",{attrs:{trigger:"custom",placement:"bottom-start",transfer:"",visible:t.visible,"transfer-class-name":"add-member-box"},on:{click:t.handleOpen,"on-clickoutside":t.handleClose}},[i("Button",{attrs:{icon:"md-add",type:"primary"},on:{click:t.handleOpen}},[t._v("添加成员")]),t._v(" "),i("DropdownMenu",{staticStyle:{padding:"10px 0 0"},attrs:{slot:"list"},slot:"list"},[i("div",{staticStyle:{padding:"0 16px"}},[i("Input",{staticClass:"width300",attrs:{icon:"ios-search",placeholder:"请输入姓名/邮箱"},on:{"on-change":t.debounceSearch},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.debounceSearch(e):null}},model:{value:t.searMember,callback:function(e){t.searMember=e},expression:"searMember"}})],1),t._v(" "),i("div",{staticClass:"ivu-select-dropdown",staticStyle:{position:"static","box-shadow":"none","max-height":"135px",overflow:"auto"}},[i("ul",{directives:[{name:"show",rawName:"v-show",value:!t.selectData.length&&!t.searLoading&&t.searMember,expression:"!selectData.length&&!searLoading&&searMember"}],staticClass:"ivu-select-not-found"},[i("li",[t._v("无匹配数据")])]),t._v(" "),i("ul",{staticClass:"ivu-select-dropdown-list"},t._l(t.selectData,function(e){return i("li",{key:e.value,staticClass:"ivu-select-item",on:{click:function(i){t.addSpecia(e)}}},[i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",{staticClass:"name-email"},[t._v(t._s(e.label))])])})),t._v(" "),i("ul",{directives:[{name:"show",rawName:"v-show",value:t.searLoading,expression:"searLoading"}],staticClass:"ivu-select-loading"},[t._v("加载中")])])])],1),t._v(" "),i("span",{staticClass:"total-count"},[t._v("共"),i("i",[t._v(t._s(t.total))]),t._v("个成员")])],1)],1),t._v(" "),i("Row",[i("Table",{staticClass:"smce-table-noscroll td-table-no-border",attrs:{loading:t.isLoading,"no-data-text":t.loadingOrNoData,columns:t.gridList.columns,data:t.gridList.data}}),t._v(" "),i("Row",{staticClass:"pageRow padding16-18",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{total:t.total,current:t.currentPage,"show-elevator":""},on:{"on-change":t.debouncePage}})],1)],1)],1)],1)])},staticRenderFns:[]};var n=i("VU/8")(s,o,!1,function(t){i("1jHF")},null,null);e.a=n.exports},t9lY:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("woOf"),s=i.n(a),o=i("Z86P"),n={name:"AddArchitect",components:{EditTitle:i("CFN8").a},props:{title:{type:String,default:"添加"},detail:{type:Object,default:function(){return{name:""}}},rootInfo:{type:Object}},created:function(){this.getConfig()},data:function(){return{btnLoading:!1,confList:[],traitItem:"",formItem:{name:"",userRule:"all"},ruleForm:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{pattern:this.$config.reg_input.reg,message:this.$config.reg_input.msg,trigger:"blur"}],userRule:[{required:!0,message:"请选择特性",trigger:"change"}]},ascription_type:{all:"all"}}},methods:{handleSelect:function(t){t?this.formItem.userRule=this.traitItem=t:this.traitItem=""},handleRadio:function(t){this.formItem.userRule=t,this.traitItem=""},cancel:function(){this.$emit("close-modal",!1),this.$refs.formArea.resetFields()},save:function(){var t=this;this.$refs.formArea.validate(function(e){if(e){var i=t.formItem,a=i.name,s=i.userRule;if("添加"===t.title){var o={name:a.trim(),res_code:s,ascription_type:t.ascription_type[s]||"trait"};t.sendRequest("/sys/orgs","post",o)}else if("修改"===t.title){var n="/sys/orgs/"+t.rootInfo.orgId+"?name="+a+"&res_code="+s;t.sendRequest(n,"put")}}})},getConfig:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/traits?size=-1&data_type=String&data_type=StringSet&visibility=public&authorized=false&lifecycle_status=active").then(function(e){var i=e.data;t.confList=i.items})},sendRequest:function(t,e,i){var a=this;this.btnLoading=!0,this.$axios[e](""+this.$config.apiDomain+t,i).then(function(){a.btnLoading=!1,a.$refs.formArea.resetFields(),a.$emit("get-root-tree-name"),a.$emit("get-root-tree"),a.$Message.success("已"+a.title),a.$emit("close-modal",!1)}).catch(function(){a.btnLoading=!1})}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-architect"},[i("Form",{ref:"formArea",attrs:{model:t.formItem,rules:t.ruleForm}},[i("edit-title",{attrs:{loading:t.btnLoading,title:"新建运营架构"},on:{"cancel-click":t.cancel,"ok-click":t.save}}),t._v(" "),i("div",{staticClass:"custom-dialog-content"},[i("div",{staticClass:"dialog-padding20 content common-card"},[i("FormItem",{staticClass:"content-name",attrs:{prop:"name"}},[i("p",{staticClass:"sub-title"},[t._v("运营架构名称")]),t._v(" "),i("Input",{staticClass:"name-input",attrs:{maxlength:20,placeholder:"请输入架构名称"},model:{value:t.formItem.name,callback:function(e){t.$set(t.formItem,"name","string"==typeof e?e.trim():e)},expression:"formItem.name"}})],1),t._v(" "),i("FormItem",{staticClass:"content-config",attrs:{prop:"userRule"}},[i("p",{staticClass:"sub-title"},[t._v("用户归属规则")]),t._v(" "),i("RadioGroup",{attrs:{vertical:""},on:{"on-change":t.handleRadio},model:{value:t.formItem.userRule,callback:function(e){t.$set(t.formItem,"userRule",e)},expression:"formItem.userRule"}},[i("Radio",{attrs:{label:"all"}},[i("span",[t._v("全量用户")]),t._v(" "),i("Tooltip",{staticClass:"tooltip",attrs:{content:"架构上各节点均覆盖渠道内全量用户",placement:"right"}},[i("i",{staticClass:"fa fa-question-circle-o f16"})])],1),t._v(" "),i("Row",[i("Col",[i("Radio",{staticClass:"trait-radio",attrs:{label:t.traitItem}},[i("span",[t._v("通过特性匹配")])]),t._v(" "),i("Select",{staticClass:"trait-select",on:{"on-change":t.handleSelect},model:{value:t.traitItem,callback:function(e){t.traitItem=e},expression:"traitItem"}},t._l(t.confList,function(e){return i("Option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),t._v(" "),i("Tooltip",{staticClass:"tooltip",attrs:{content:"架构上各节点将只包含特性值与节点编码精确匹配的用户","max-width":200,transfer:""}},[i("i",{staticClass:"fa fa-question-circle-o f16"})])],1)],1)],1)],1)],1)])],1)],1)},staticRenderFns:[]};var c=i("VU/8")(n,r,!1,function(t){i("hLL3")},"data-v-4e7b169d",null).exports,l={name:"AddOperationTree",components:{CustomTree:o.a,AddArchitect:c},data:function(){return{rootId:"",isLoading:!0,treeNum:0,rootList:[],initialData:[],isShowDrawPage:!1,title:"",detail:{},infoParams:{},rootInfo:{},initStatus:!1,selectItem:""}},created:function(){this.getRootTree(),this.getRootTreeName()},mounted:function(){var t=this;this.$tools.bus.$on("finishUploadTreeData",function(e){t.getRootTree(e)})},beforeDestroy:function(){this.$tools.bus.$off("finishUploadTreeData"),this.$tools.bus.$off("watchRootId")},watch:{rootList:function(){this.showTableTab(this.rootList.length)},initialData:{handler:function(){this.initialData.length&&(this.rootId=this.initialData[0].org_id)},immediate:!0},rootId:function(){var t=this;this.getSelectItem(),this.$tools.bus.$on("watchRootId",function(e){e.org_id===t.rootId&&t.getRootTreeName()})}},methods:{allowDrag:function(t){return!(0===t.nodeKey&&!t.org_parent_id)},allowDrop:function(t){return t.isSameParent},drop:function(t){this.getChildren(t)},getChildren:function(t){var e=this,i=t.after,a=t.draggingNode,s=t.parentNode,o=i?"&dest_org_id="+i.org_id:"",n=this.$config.apiDomain+"/sys/orgs/"+a.org_id+"/weight?org_parent_id="+s.org_id+o;this.$axios.put(n).then(function(t){var i=t.data.children,a=s.children;e.$tools.replaceData(i,a,"org_id"),e.$set(s,"children",i)})},getSelectItem:function(){var t=this;this.rootList.map(function(e){e.org_id===t.rootId&&(t.selectItem=e.name)})},closeModal:function(t){this.isShowDrawPage=t},addTree:function(){this.isShowDrawPage=!0,this.title="添加"},modifyTree:function(){this.isShowDrawPage=!0,this.title="修改",this.detail={name:this.initialData.name||"",customerEvent:""}},getRootTree:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isLoading=!0;this.$axios.get(this.$config.apiDomain+"/sys/orgs/list-orgs",{params:s()(e,{size:-1})}).then(function(e){var i=e.data;t.isLoading=!1,i&&i.items&&i.items.length&&(t.initialData=t.$tools.formatTreeData(i.items))}).catch(function(){t.isLoading=!1})},getRootTreeName:function(){var t=this;this.$axios.get(this.$config.apiDomain+"/sys/orgs/list-root-orgs",{params:{size:-1}}).then(function(e){var i=e.data;t.initStatus=!0,t.rootList=i.items,t.getSelectItem(),t.treeNum=i&&i.items&&i.items.length||0,t.treeNum&&t.$emit("get-tree-num",t.treeNum)}).catch(function(){t.initStatus=!0})},addTreeNode:function(t){var e=this,i=this,a=t.data,s=t.root,o=t.node,n=t.parent,r=a,c={name:r.name},l="/sys/orgs/"+n.org_id+"/child";this.$axios.post(""+this.$config.apiDomain+l,c).then(function(t){var a=t.data;e.$Message.destroy(),e.$Message.success("已添加"),i.$set(r,"org_id",a.org_id),i.$set(r,"isEdit",!1)}).catch(function(){e.removeData(r,o,s)})},removeTreeNode:function(t){var e=this,i=t.data,a=t.root,s=t.node,o=i,n=o.org_id,r="/sys/orgs/"+n;n?this.$axios.delete(""+this.$config.apiDomain+r).then(function(){e.$Message.destroy(),e.$Message.success("已删除"),e.removeData(o,s,a)}).catch(function(){}):this.removeData(o,s,a)},removeData:function(t,e,i){var a=i.find(function(t){return t===e}).parent,s=i.find(function(t){return t.nodeKey===a}).node,o=s.children.indexOf(t);s.children.splice(o,1)},editTreeNode:function(t){var e=this,i={name:t.name,user_trait_values:"[]"},a="/sys/orgs/"+t.org_id;this.$axios.put(""+this.$config.apiDomain+a,i).then(function(){e.$Message.destroy(),e.$Message.success("已修改"),e.$set(t,"isEdit",!1)}).catch(function(){e.$set(t,"isEdit",!1)})},showTableTab:function(t){this.$emit("show-table-tab-data",this.treeNum||t)},getTableData:function(t){var e=this.initialData[0],i=e.name,a=e.res_code,s=e.res_name,o=e.org_id,n=e.ascription_type,r=e.customer_count;this.rootInfo={name:i,res_code:a,org_id:o,res_name:s,ascription_type:n,customer_count:r};var c=t.user_trait_values;if(c&&"string"==typeof c)if(c.indexOf("[")>-1&&c.indexOf("]")>-1)t.user_trait_values=JSON.parse(c);else{var l=[];c&&c.length&&l.push(c),t.user_trait_values=l}this.$tools.bus.$emit("loadNodeInfo",t,this.rootInfo,o),this.$tools.bus.$emit("handleClickTreeNode")},handleSelect:function(t){var e=t.org_id,i={org_id:e};this.rootId=e,this.getRootTree(i)},updateArchitectInfo:function(t){if(t.org_id===this.rootId){var e=t.name,i=t.user_trait_display_name,a=t.org_id;this.initialData[0]=s()(this.initialData[0],{name:e,user_trait_display_name:i,org_id:a})}}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"operation-tree"},[t.isLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),t.initStatus&&t.treeNum?a("div",{staticClass:"has-tree"},[a("Dropdown",{staticClass:"select-wrapper",attrs:{trigger:"click"}},[a("Button",{staticClass:"title",attrs:{type:"text"}},[a("span",{staticClass:"content"},[t._v(t._s(t.selectItem))]),t._v(" "),a("span",{staticClass:"iconfont icon-nav_arrow_drop_down icon"})]),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("div",{staticClass:"list-wrapper"},t._l(t.rootList,function(e){return a("DropdownItem",{key:e.org_id,class:{selected:e.org_id===t.rootId},nativeOn:{click:function(i){t.handleSelect(e)}}},[t._v(t._s(e.name))])})),t._v(" "),a("DropdownItem",{staticClass:"add-btn",attrs:{divided:""},nativeOn:{click:function(e){return t.addTree(e)}}},[a("span",{staticClass:"iconfont icon-content_add"}),t._v("新建架构")])],1)],1),t._v(" "),a("div",{staticClass:"tree-list"},[a("custom-tree",{attrs:{data:t.initialData,"max-level":5,tid:"org_id","parent-id":"org_parent_id","confirm-modal-type":"节点","confirm-modal-content":"删除后将无法恢复。",isShowAddIcon:"",isShowDelIcon:"",isShowNum:!1,"allow-drop":t.allowDrop,"allow-drag":t.allowDrag},on:{drop:t.drop,"get-table-tab-data":t.getTableData,"add-tree-node":t.addTreeNode,"remove-tree-node":t.removeTreeNode}})],1)],1):t._e(),t._v(" "),t.initStatus&&!t.treeNum?a("div",{staticClass:"no-tree"},[a("img",{attrs:{src:i("tSfT")}}),t._v(" "),a("p",{staticStyle:{"line-height":"26px",height:"26px"}}),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.addTree}},[t._v("新建运营架构")])],1):t._e(),t._v(" "),a("Drawer",{attrs:{width:"750","mask-closable":!1},model:{value:t.isShowDrawPage,callback:function(e){t.isShowDrawPage=e},expression:"isShowDrawPage"}},[t.isShowDrawPage?a("add-architect",{attrs:{title:t.title},on:{"close-modal":t.closeModal,"get-root-tree":t.getRootTree,"get-root-tree-name":t.getRootTreeName}}):t._e()],1)],1)},staticRenderFns:[]};var u=i("VU/8")(l,d,!1,function(t){i("8FFS")},null,null).exports,g=i("mvHQ"),h=i.n(g),m=i("M4fF"),f=i("hmnT"),p=i("mps7"),D={name:"NodeInfo",components:{MultipleTag:f.a,EditInput:p.a},props:{rootInfo:{type:Object,default:function(){return{}}},orgInfo:{type:Object,default:function(){return{}}},rootId:{type:String,default:""}},data:function(){return{multagWidth:50,tempForm:{},formItem:{name:"",user_trait_values:[]},ruleForm:{name:[{required:!0,message:"请输入名称",trigger:"blur, change"},{pattern:this.$config.reg_input.reg,message:this.$config.reg_input.msg,trigger:"blur, change"}]},downloadLink:this.$config.apiDomain+"/sys/orgs/org-template",uploadLink:"",isView:!0,btnLoading:!1,ruleContent:"",showEdit:!0,tagPlaceholder:"无"}},mounted:function(){this.getInfo()},methods:{stopFormAction:function(t){t.preventDefault()},getInfo:function(){var t=this.orgInfo,e=t.name,i=t.user_trait_values,a=t.org_id,s=Object(m.cloneDeep)(i);this.tempForm={name:e,user_trait_values:i},this.formItem={name:e,user_trait_values:s},this.ruleContent="all"===this.rootInfo.ascription_type?"将渠道内全量用户划分到各节点":"通过特性将用户数据划分到相应节点，与节点编码精确匹配的用户数据，将被划分到当前节点的数据权限范围内",this.uploadLink=this.$config.apiDomain+"/sys/orgs/org-importing?org_id="+a},change:function(t){this.formItem.name=t},changeStatus:function(t){this.showEdit=t},changeTagStatus:function(t){this.isView=t},confirm:function(){this.saveNodeInfo()},close:function(){this.getInfo(),this.showEdit=!0},cancelEdit:function(){this.getInfo(),this.isView=!0,this.showEdit=!0},saveNodeInfo:function(){var t=this;this.$refs.formArea.validate(function(e){e&&(h()(t.tempForm)===h()(t.formItem)?(t.showEdit=!0,t.isView=!0):t.sendRequest())})},sendRequest:function(){var t=this;this.btnLoading=!0;var e=this.formItem,i=e.name,a=e.user_trait_values,o={name:i,user_trait_values:h()(a)},n="/sys/orgs/"+this.orgInfo.org_id;this.$axios.put(""+this.$config.apiDomain+n,o).then(function(){t.btnLoading=!1,t.showEdit=!0,t.isView=!0,t.$Message.success("已修改");var e=s()(t.orgInfo,{name:i,user_trait_values:a});t.$tools.bus.$emit("watchRootId",e),t.$emit("update-architect-info",e)}).catch(function(){t.btnLoading=!1})},beforeUpload:function(){this.$emit("loading",!0)},handleSuccess:function(){this.$Message.info({content:"导入成功",duration:3});var t={org_id:this.rootInfo.org_id};this.$emit("loading",!1),this.$tools.bus.$emit("finishUploadTreeData",t)},uploadSizeError:function(){this.$Message.destroy(),this.$Message.error({content:"无法导入，文件大小超过限制",duration:5}),this.$emit("loading",!1)},handleFormatError:function(){this.$Message.destroy(),this.$Message.error({content:"无法导入，请检查文件格式",duration:5}),this.$emit("loading",!1)},handleError:function(t,e){this.$Message.destroy(),this.$Message.error({content:e.message,duration:5}),this.$emit("loading",!1)},changeTag:function(t){this.formItem=s()({},this.formItem,{user_trait_values:t})},dealTraitCodeArr:function(t){var e=t.user_trait_values;if(e)if(e.indexOf("[")>-1&&e.indexOf("]")>-1)e=JSON.parse(e);else{var i=[];e&&e.length&&i.push(e),e=i}return t=s()(t,{user_trait_values:e})}},watch:{orgInfo:{handler:function(){this.getInfo(),this.showEdit=!0,this.isView=!0,(!this.formItem.user_trait_values||"[]"===this.formItem.user_trait_values)&&(this.tagPlaceholder="无"),this.$refs.multag&&(this.$refs.multag.isActive=!1)},deep:!0},isView:function(){this.tagPlaceholder=this.isView?"无":"请添加",this.multagWidth=this.isView?50:300}}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"base-info bottom-shadow"},[i("Form",{ref:"formArea",staticClass:"form-wrapper",attrs:{model:t.formItem,rules:t.ruleForm},nativeOn:{submit:function(e){return t.stopFormAction(e)}}},[i("Row",{staticClass:"title"},[i("Col",{staticClass:"name",attrs:{span:"12"}},[i("edit-input",{staticClass:"node-name",attrs:{"form-prop":"name","edit-show":t.showEdit},on:{change:t.change,"confirm-info":t.saveNodeInfo,"cancel-edit":t.cancelEdit,"change-status":t.changeStatus},model:{value:t.formItem.name,callback:function(e){t.$set(t.formItem,"name",e)},expression:"formItem.name"}})],1),t._v(" "),i("Col",{staticClass:"upload",attrs:{span:"12"}},[i("a",{attrs:{href:t.downloadLink}},[t._v("下载模板")]),t._v(" "),i("Tooltip",{staticClass:"tooltip",attrs:{transfer:"","max-width":"250",content:"对不存在子节点的，可导入文件进行初始化设置；对已存在子节点的无法导入",placement:"right"}},[i("Upload",{attrs:{"show-upload-list":!1,multiple:"",format:["xlsx","xls"],"on-format-error":t.handleFormatError,"max-size":1024,"on-exceeded-size":t.uploadSizeError,action:t.uploadLink,"before-upload":t.beforeUpload,"on-success":t.handleSuccess,"on-error":t.handleError}},[i("Button",[i("span",{staticClass:"iconfont icon-file_upload custom-icon"}),t._v("\n                            导入子节点\n                        ")])],1)],1)],1)],1),t._v(" "),i("Row",{staticClass:"content-wrapper"},[i("Col",{staticClass:"root-info",attrs:{span:"24"}},[i("span",{staticClass:"info-name"},[t._v("用户归属规则：")]),t._v(" "),i("span",{staticClass:"info-detail"},[t._v(t._s(t.rootInfo.res_name)+"\n                    "),i("Tooltip",{staticClass:"tooltip",attrs:{content:t.ruleContent,placement:"right"}},[i("span",{staticClass:"iconfont icon-action_help_outline"})])],1),t._v(" "),i("span",{staticClass:"info-name"},[t._v("用户数：")]),t._v(" "),i("span",[t._v("共\n                    "),i("span",{staticClass:"customer-count"},[t._v(t._s(t._f("formatAmount")(t.orgInfo.customer_count||0)))]),t._v("人\n                ")])]),t._v(" "),"all"!==t.rootInfo.ascription_type?i("Col",{attrs:{span:"24"}},[i("multiple-tag",{ref:"multag",staticClass:"node-code-wrapper nopl",attrs:{hasEditIcon:!0,labelName:"节点编码：","form-label-width":76,"is-view":t.isView,"tag-arr":t.formItem.user_trait_values,canKeyDel:"",customReg:"",tagPlaceholder:t.tagPlaceholder,"tag-width":t.multagWidth},on:{"change-tag":t.changeTag,"change-status":t.changeTagStatus,confirm:t.confirm,close:t.close}})],1):t._e()],1)],1)],1)},staticRenderFns:[]};var _={data:function(){return{isLoading:!1,rootInfo:{},orgInfo:{},rootId:"",num:0}},methods:{getLoading:function(t){this.isLoading=t},getTreeNum:function(t){this.num=t},updateArchitectInfo:function(t){if(t.org_id===this.rootId){var e=t.name,i=t.user_trait_display_name,a=t.org_id;this.rootInfo=s()({},this.rootInfo,{name:e,user_trait_display_name:i,org_id:a})}}},computed:{},watch:{},components:{AddOperationTree:u,NodeInfo:i("VU/8")(D,v,!1,function(t){i("Z3po")},null,null).exports,Specialist:i("oSpf").a},mounted:function(){var t=this;this.$tools.bus.$on("loadNodeInfo",function(e,i,a){t.rootId=a,t.orgInfo=e,t.rootInfo=i})},beforeDestroy:function(){this.$tools.bus.$off("loadNodeInfo")}},I={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"authorization"},[i("div",{staticClass:"tree-wrapper"},[i("add-operation-tree",{on:{"get-tree-num":t.getTreeNum}})],1),t._v(" "),[t.num?i("div",{staticClass:"info-wrapper"},[t.isLoading?i("Spin",{attrs:{size:"large",fix:""}},[i("span",{staticClass:"iconfont icon-notification_sync spin-icon-load"}),t._v(" "),i("div",[t._v("导入中...")])]):t._e(),t._v(" "),i("node-info",{attrs:{"root-id":t.rootId,"root-info":t.rootInfo,"org-info":t.orgInfo},on:{loading:t.getLoading,"update-architect-info":t.updateArchitectInfo}}),t._v(" "),i("specialist",{attrs:{isOrg:"","org-info":t.orgInfo}})],1):i("div")]],2)},staticRenderFns:[]};var M=i("VU/8")(_,I,!1,function(t){i("fSzI")},"data-v-8bf3135a",null);e.default=M.exports},tSfT:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTMzNzIzMjI0MjY5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjUgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijc0NzciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwLjE5NTMxMjUiIGhlaWdodD0iMjAwIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik05NzcuOTY2NzI0IDcxMi41MTQ2NzhoLTc0LjgzMzIyOVY1MTEuNjgwMmE0NS40MTE2MTggNDUuNDExNjE4IDAgMCAwLTQ1LjQxMTYxOC00Ni4wNTEyMThINTQxLjc1OTM1NFYzMTAuMjA2MTIxaDc1LjQ3MjgzYTQ2LjA1MTIxOCA0Ni4wNTEyMTggMCAwIDAgNDQuNzcyMDE3LTQ2LjY5MDgxOFY0Ni42OTA4MThhNDUuNDExNjE4IDQ1LjQxMTYxOCAwIDAgMC00NC43NzIwMTctNDYuNjkwODE4aC0yMTEuMDY4MDgzYTQ1LjQxMTYxOCA0NS40MTE2MTggMCAwIDAtNDQuNzcyMDE3IDQ2LjA1MTIxOHYyMTcuNDY0MDg1YTQ2LjA1MTIxOCA0Ni4wNTEyMTggMCAwIDAgNDQuNzcyMDE3IDQ2LjY5MDgxOGg3NS40NzI4M3YxNTQuNzgzMjYxSDE2NS42NzQ0MDdhNDUuNDExNjE4IDQ1LjQxMTYxOCAwIDAgMC00NS40MTE2MTggNDYuNjkwODE4djIwMS40NzQwNzlINDUuNDI5NTZhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMC00NS40MTE2MTggNDYuNjkwODE4djIxNi4xODQ4ODRhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMCA0NS40MTE2MTggNDcuMzMwNDE5SDI1NS44NTgwNDJhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMCA0NS40MTE2MTgtNDYuNjkwODE4di0yMTcuNDY0MDg1YTQ2LjA1MTIxOCA0Ni4wNTEyMTggMCAwIDAtNDUuNDExNjE4LTQ2LjY5MDgxOUgxODAuMzg1MjEzVjUyNi4zOTEwMDZoMzAxLjI1MTcxOHYxODYuMTIzNjcySDQwNi4xNjQxMDFhNDUuNDExNjE4IDQ1LjQxMTYxOCAwIDAgMC00NC43NzIwMTcgNDYuNjkwODE5djIxNi4xODQ4ODRhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMCA0NC43NzIwMTcgNDYuNjkwODE4aDIxMS4wNjgwODNhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMCA0NC43NzIwMTctNDYuNjkwODE4di0yMTYuMTg0ODg0YTQ1LjQxMTYxOCA0NS40MTE2MTggMCAwIDAtNDQuNzcyMDE3LTQ2LjY5MDgxOUg1NDEuNzU5MzU0VjUyNi4zOTEwMDZoMzAxLjI1MTcxOHYxODYuMTIzNjcySDc2Ny41MzgyNDJhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMC00NS40MTE2MTcgNDYuNjkwODE5djIxNi4xODQ4ODRhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMCA0NS40MTE2MTcgNDcuOTcwMDE5aDIxMC40Mjg0ODJhNDYuMDUxMjE4IDQ2LjA1MTIxOCAwIDAgMCA0NS40MTE2MTgtNDYuNjkwODE4di0yMTcuNDY0MDg1YTQ2LjA1MTIxOCA0Ni4wNTEyMTggMCAwIDAtNDUuNDExNjE4LTQ2LjY5MDgxOXpNNDIxLjUxNDUwNyA2My45NjAwMjVoMTgwLjM2NzI3MXYxODQuMjA0ODcySDQyMS41MTQ1MDd6TTI0MC41MDc2MzYgNzc0LjU1NTkwM3YxODQuODQ0NDcySDYwLjE0MDM2NnYtMTg1LjQ4NDA3M3ogbTM2MS4zNzQxNDIgMTg0Ljg0NDQ3Mkg0MjEuNTE0NTA3di0xODUuNDg0MDczaDE4MC4zNjcyNzF6IG0zNjEuMzc0MTQxIDBoLTE4MS4wMDY4NzF2LTE4NS40ODQwNzNoMTgxLjAwNjg3MXoiIGZpbGw9IiM5OTk5OTkiIHAtaWQ9Ijc0NzgiPjwvcGF0aD48L3N2Zz4="}});